<!doctype html><html lang=en-us dir=ltr><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Masking # Prompt: Implement a kinegram and some moiré patterns which are close related visual phenomena to masking.
Visual masking is the reduction or elimination of the visibility of one brief (≤ 50 ms) stimulus, called the “target”, by the presentation of a second brief stimulus, called the “mask”. Introduced near the end of the 19th and beginning of the 20th century (Exner, 1868; McDougal, 1904; Sherrington, 1897; Stigler, 1911) and extensively studied since then, masking, an interesting phenomenon in its own right, is a useful tool for exploring the dynamics of visual information processing (Breitmeyer & Öğmen, 2006)."><meta name=theme-color content="#FFFFFF"><meta name=color-scheme content="light dark"><meta property="og:title" content><meta property="og:description" content="Masking # Prompt: Implement a kinegram and some moiré patterns which are close related visual phenomena to masking.
Visual masking is the reduction or elimination of the visibility of one brief (≤ 50 ms) stimulus, called the “target”, by the presentation of a second brief stimulus, called the “mask”. Introduced near the end of the 19th and beginning of the 20th century (Exner, 1868; McDougal, 1904; Sherrington, 1897; Stigler, 1911) and extensively studied since then, masking, an interesting phenomenon in its own right, is a useful tool for exploring the dynamics of visual information processing (Breitmeyer & Öğmen, 2006)."><meta property="og:type" content="article"><meta property="og:url" content="https://andryut.github.io/showcase/docs/exercises/Masking/"><meta property="article:section" content="docs"><meta property="article:modified_time" content="2023-04-27T10:58:00-05:00"><title>Masking | Showcase Template</title><link rel=manifest href=/showcase/manifest.json><link rel=icon href=/showcase/favicon.png type=image/x-icon><link rel=stylesheet href=/showcase/book.min.4b35fed0bea034bbc19c89c71e14b73fb9c68cfcc586b9382adfb9b7b103ba06.css integrity="sha256-SzX+0L6gNLvBnInHHhS3P7nGjPzFhrk4Kt+5t7EDugY=" crossorigin=anonymous><script defer src=/showcase/flexsearch.min.js></script>
<script defer src=/showcase/en.search.min.3a8d658c77eb93c7f12a2b8af49a700131e474f288eefb605d9fa61576dbe5a7.js integrity="sha256-Oo1ljHfrk8fxKiuK9JpwATHkdPKI7vtgXZ+mFXbb5ac=" crossorigin=anonymous></script></head><body dir=ltr><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a class="flex align-center" href=/showcase/><span>Showcase Template</span></a></h2><div class=book-search><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><ul><li class=book-section-flat><a href=/showcase/docs/team/>Team</a><ul></ul></li><li class=book-section-flat><a href=/showcase/docs/exercises/>Exercises</a><ul><li><a href=/showcase/docs/exercises/Coloring/>Coloring</a></li><li><a href=/showcase/docs/exercises/Depth-Perception/>Depth Perception</a></li><li><a href=/showcase/docs/exercises/Mach-Bands/>Mach Bands</a></li><li><a href=/showcase/docs/exercises/Masking/ class=active>Masking</a></li><li><a href=/showcase/docs/exercises/Spatial-Coherence/>Spatial Coherence</a></li><li><a href=/showcase/docs/exercises/Temporal-Coherence/>Temporal Coherence</a></li><li><a href=/showcase/docs/exercises/Visual-Illusions/>Visual Illusions</a></li></ul></li><li><input type=checkbox id=section-9370f1a5d0248572ac505e0c6d4ad190 class=toggle>
<label for=section-9370f1a5d0248572ac505e0c6d4ad190 class="flex justify-between"><a href=/showcase/docs/shortcodes/>Shortcodes</a></label><ul><li><a href=/showcase/docs/shortcodes/buttons/>Buttons</a></li><li><a href=/showcase/docs/shortcodes/columns/>Columns</a></li><li><a href=/showcase/docs/shortcodes/details/>Details</a></li><li><a href=/showcase/docs/shortcodes/hints/>Hints</a></li><li><a href=/showcase/docs/shortcodes/katex/>Katex</a></li><li><a href=/showcase/docs/shortcodes/mermaid/>Mermaid</a></li><li><input type=checkbox id=section-ec67a64aba70b9df3d2a9acd6c92e3bc class=toggle>
<label for=section-ec67a64aba70b9df3d2a9acd6c92e3bc class="flex justify-between"><a href=/showcase/docs/shortcodes/p5/>P5</a></label><ul><li><a href=/showcase/docs/shortcodes/p5/iframe/>Iframe</a></li><li><a href=/showcase/docs/shortcodes/p5/div/>Div</a></li></ul></li><li><a href=/showcase/docs/shortcodes/tabs/>Tabs</a></li></ul></li></ul><ul><li><a href=/showcase/posts/>Blog</a></li></ul></nav><script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/showcase/svg/menu.svg class=book-icon alt=Menu></label>
<strong>Masking</strong>
<label for=toc-control><img src=/showcase/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><a href=#masking>Masking</a><ul><li><a href=#kinegram>Kinegram</a><ul><li><a href=#implementation>Implementation</a></li></ul></li><li><a href=#moire-pattern>Moire Pattern</a><ul><li><a href=#implementation-1>Implementation</a></li></ul></li></ul></li><li><a href=#floyd-steinberg-dithering>Floyd-Steinberg dithering</a><ul><li><a href=#quantizing>Quantizing</a></li><li><a href=#quantizing-error>Quantizing error</a></li><li><a href=#floyd-steinberg-algorithm>Floyd-Steinberg algorithm</a></li></ul></li><li><a href=#floyd-steinberg-dithering-1>Floyd-Steinberg dithering</a><ul><li><a href=#quantizing-1>Quantizing</a></li><li><a href=#quantizing-error-1>Quantizing error</a></li><li><a href=#floyd-steinberg-algorithm-1>Floyd-Steinberg algorithm</a></li><li><a href=#web-app>Web app</a></li></ul></li></ul></nav></aside></header><article class=markdown><h1 id=masking>Masking
<a class=anchor href=#masking>#</a></h1><blockquote><p><strong>Prompt:</strong> Implement a <a href=https://michaelbach.de/ot/mot-scanimation/index.html>kinegram</a> and some <a href=https://en.wikipedia.org/wiki/Moir%C3%A9_pattern>moiré patterns</a> which are close related visual phenomena to masking.</p></blockquote><p>Visual masking is the reduction or elimination of the visibility of one brief (≤ 50 ms) stimulus, called the “target”, by the presentation of a second brief stimulus, called the “mask”. Introduced near the end of the 19th and beginning of the 20th century (Exner, 1868; McDougal, 1904; Sherrington, 1897; Stigler, 1911) and extensively studied since then, masking, an interesting phenomenon in its own right, is a useful tool for exploring the dynamics of visual information processing (Breitmeyer & Öğmen, 2006). As a technique for studying the dynamic and microgenetic aspects of vision <a href=http://www.scholarpedia.org/article/Visual_masking>Visual Masking</a>.</p><h2 id=kinegram>Kinegram
<a class=anchor href=#kinegram>#</a></h2><p>Visual artist Gianni A. Sarcone has produced animations that he calls kinegrams since 1997. He describes his animations as &ldquo;optic kinetic media&rdquo; that &ldquo;artfully combine the visual effects of moiré patterns with the zoetrope animation technique&rdquo;. Sarcone also created rotating animations that use a transparent disc with radial lines that has to be spun around its center to animate the picture <a href=https://en.wikipedia.org/wiki/Barrier-grid_animation_and_stereography#Kinegram>Kinegram</a></p><h3 id=implementation>Implementation
<a class=anchor href=#implementation>#</a></h3><p>In the following image there is a background image that is composed of a wolf main shape, but the figures that represent the wolf legs are incomplete and superimposed to allow a grid in movement to create the illusion of movement. Deepening in the code it was just required create multiple vertical lines and add an xOffset depending of the selected speed.</p><details><summary>Kinegram</summary><div class=markdown-inner><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>startButton</span>, <span style=color:#a6e22e>stopButton</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>xOffset</span>, <span style=color:#a6e22e>xSpeed</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>img</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>preload</span>() {
</span></span><span style=display:flex><span> <span style=color:#a6e22e>img</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>loadImage</span>(<span style=color:#e6db74>&#39;/showcase/lobo.jpg&#39;</span>);
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>setup</span>() {
</span></span><span style=display:flex><span> <span style=color:#a6e22e>createCanvas</span>(<span style=color:#ae81ff>700</span>, <span style=color:#ae81ff>400</span>);
</span></span><span style=display:flex><span> <span style=color:#a6e22e>text</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>createP</span>(<span style=color:#e6db74>&#34;Speed&#34;</span>);
</span></span><span style=display:flex><span> <span style=color:#a6e22e>startButton</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>createButton</span>(<span style=color:#e6db74>&#39;Start&#39;</span>);
</span></span><span style=display:flex><span> <span style=color:#a6e22e>startButton</span>.<span style=color:#a6e22e>mousePressed</span>(<span style=color:#a6e22e>startGrid</span>);
</span></span><span style=display:flex><span> <span style=color:#a6e22e>stopButton</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>createButton</span>(<span style=color:#e6db74>&#39;Stop&#39;</span>);
</span></span><span style=display:flex><span> <span style=color:#a6e22e>stopButton</span>.<span style=color:#a6e22e>mousePressed</span>(<span style=color:#a6e22e>stopGrid</span>);
</span></span><span style=display:flex><span> <span style=color:#a6e22e>input</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>createInput</span>();
</span></span><span style=display:flex><span> <span style=color:#a6e22e>input</span>.<span style=color:#a6e22e>value</span>(<span style=color:#ae81ff>2.5</span>);
</span></span><span style=display:flex><span> <span style=color:#a6e22e>startGrid</span>();
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>draw</span>() {
</span></span><span style=display:flex><span> <span style=color:#a6e22e>background</span>(<span style=color:#a6e22e>img</span>);
</span></span><span style=display:flex><span> <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>xOffset</span>) {
</span></span><span style=display:flex><span>   <span style=color:#a6e22e>xOffset</span> <span style=color:#f92672>+=</span> <span style=color:#a6e22e>xSpeed</span>;
</span></span><span style=display:flex><span>   <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>xOffset</span> <span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>width</span>) {
</span></span><span style=display:flex><span>     <span style=color:#a6e22e>xOffset</span> <span style=color:#f92672>=</span> <span style=color:#f92672>-</span><span style=color:#a6e22e>width</span>;
</span></span><span style=display:flex><span>   }
</span></span><span style=display:flex><span> }
</span></span><span style=display:flex><span> <span style=color:#a6e22e>drawLines</span>();
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>drawLines</span>() {
</span></span><span style=display:flex><span> <span style=color:#a6e22e>stroke</span>(<span style=color:#ae81ff>0</span>);
</span></span><span style=display:flex><span> <span style=color:#a6e22e>strokeWeight</span>(<span style=color:#ae81ff>5</span>);
</span></span><span style=display:flex><span> <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>lineSpacing</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>10</span>;
</span></span><span style=display:flex><span> <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>let</span> <span style=color:#a6e22e>x</span> <span style=color:#f92672>=</span> <span style=color:#f92672>-</span><span style=color:#a6e22e>width</span><span style=color:#f92672>*</span><span style=color:#ae81ff>1000</span>; <span style=color:#a6e22e>x</span> <span style=color:#f92672>&lt;</span> <span style=color:#a6e22e>width</span><span style=color:#f92672>*</span><span style=color:#ae81ff>1000</span>; <span style=color:#a6e22e>x</span> <span style=color:#f92672>+=</span> <span style=color:#a6e22e>lineSpacing</span>) {
</span></span><span style=display:flex><span>   <span style=color:#a6e22e>line</span>(<span style=color:#a6e22e>x</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>xOffset</span>, <span style=color:#ae81ff>0</span>, <span style=color:#a6e22e>x</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>xOffset</span>, <span style=color:#a6e22e>height</span>);
</span></span><span style=display:flex><span> }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>startGrid</span>() {
</span></span><span style=display:flex><span> <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>val</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>input</span>.<span style=color:#a6e22e>value</span>();
</span></span><span style=display:flex><span> <span style=color:#a6e22e>xSpeed</span> <span style=color:#f92672>=</span> parseFloat(<span style=color:#a6e22e>val</span>);
</span></span><span style=display:flex><span> <span style=color:#a6e22e>xOffset</span> <span style=color:#f92672>=</span> <span style=color:#f92672>-</span><span style=color:#a6e22e>width</span>;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>stopGrid</span>() {
</span></span><span style=display:flex><span> <span style=color:#a6e22e>xOffset</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>null</span>;
</span></span><span style=display:flex><span>}</span></span></code></pre></div></div></details><iframe id=kinegram style=width:730px;height:500px srcdoc="
        <!DOCTYPE html>
        <html>
          <head>
            <script src=https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.5.0/p5.min.js></script>
            <script src=https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.5.0/addons/p5.sound.min.js></script>
            
            
            
            
            
            <script src=/showcase/sketches/exercises/visual_illusions/kinegram.js></script>
          </head>
          <body>
          </body>
        </html>
      "></iframe><h2 id=moire-pattern>Moire Pattern
<a class=anchor href=#moire-pattern>#</a></h2><p>Moire patterns are large-scale interference patterns that can be produced when a partially opaque ruled pattern with transparent gaps is overlaid on another similar pattern. For the moiré interference pattern to appear, the two patterns must not be completely identical, but rather displaced, rotated, or have slightly different pitch. <a href=https://en.wikipedia.org/wiki/Moir%C3%A9_pattern>Moiré pattern</a></p><h3 id=implementation-1>Implementation
<a class=anchor href=#implementation-1>#</a></h3><p>In the first moire pattern were used mutiple circles and squares separated by an input parameter and multiplied by another parameter, the shapes are rotating endlessly and the dynamic intersection of the shapes create multiple figures along the created intersections sets.</p><p>In the second implemented moire pattern we use traingles and rectangles in the same way as the first pattern.
Each pattern has two inputs, the first is the number of shapes to print and the second is the size of the shapes.</p><details><summary>Moire Pattern 1</summary><div class=markdown-inner><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>figuresCount</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>100</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>shapeSize</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>4</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>setup</span>() {
</span></span><span style=display:flex><span> <span style=color:#a6e22e>createCanvas</span>(<span style=color:#ae81ff>400</span>, <span style=color:#ae81ff>400</span>);
</span></span><span style=display:flex><span> <span style=color:#a6e22e>shapesCount</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>createInput</span>(<span style=color:#a6e22e>figuresCount</span>);
</span></span><span style=display:flex><span> <span style=color:#a6e22e>shapesCount</span>.<span style=color:#a6e22e>value</span>(<span style=color:#ae81ff>100</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span> <span style=color:#a6e22e>shapeSizesInput</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>createInput</span>(<span style=color:#a6e22e>shapeSize</span>);
</span></span><span style=display:flex><span> <span style=color:#a6e22e>shapeSizesInput</span>.<span style=color:#a6e22e>value</span>(<span style=color:#ae81ff>10</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span> <span style=color:#a6e22e>shapesCount</span>.<span style=color:#a6e22e>input</span>(() =&gt; {
</span></span><span style=display:flex><span>   <span style=color:#a6e22e>figuresCount</span> <span style=color:#f92672>=</span> parseInt(<span style=color:#a6e22e>shapesCount</span>.<span style=color:#a6e22e>value</span>());
</span></span><span style=display:flex><span> });
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span> <span style=color:#a6e22e>shapeSizesInput</span>.<span style=color:#a6e22e>input</span>(() =&gt; {
</span></span><span style=display:flex><span>   <span style=color:#a6e22e>shapeSize</span> <span style=color:#f92672>=</span> parseInt(<span style=color:#a6e22e>shapeSizesInput</span>.<span style=color:#a6e22e>value</span>());
</span></span><span style=display:flex><span> });
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>rotationAngle</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>draw</span>() {
</span></span><span style=display:flex><span> <span style=color:#a6e22e>background</span>(<span style=color:#ae81ff>220</span>);
</span></span><span style=display:flex><span> <span style=color:#a6e22e>noFill</span>();
</span></span><span style=display:flex><span> <span style=color:#a6e22e>strokeWeight</span>(<span style=color:#ae81ff>2</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span> <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>let</span> <span style=color:#a6e22e>i</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>; <span style=color:#a6e22e>i</span> <span style=color:#f92672>&lt;</span> <span style=color:#a6e22e>figuresCount</span>; <span style=color:#a6e22e>i</span><span style=color:#f92672>++</span>) {
</span></span><span style=display:flex><span>   <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>squareW</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>shapeSize</span> <span style=color:#f92672>*</span> (<span style=color:#a6e22e>figuresCount</span> <span style=color:#f92672>-</span> <span style=color:#a6e22e>i</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>   <span style=color:#a6e22e>rotate</span>(<span style=color:#a6e22e>radians</span>(<span style=color:#a6e22e>rotationAngle</span>)); 
</span></span><span style=display:flex><span>   <span style=color:#a6e22e>stroke</span>(<span style=color:#e6db74>&#34;black&#34;</span>);
</span></span><span style=display:flex><span>   <span style=color:#a6e22e>rectMode</span>(<span style=color:#a6e22e>CENTER</span>);
</span></span><span style=display:flex><span>   <span style=color:#a6e22e>rect</span>(<span style=color:#f92672>-</span><span style=color:#a6e22e>squareW</span><span style=color:#f92672>/</span><span style=color:#ae81ff>2</span>, <span style=color:#f92672>-</span><span style=color:#a6e22e>squareW</span><span style=color:#f92672>/</span><span style=color:#ae81ff>2</span>, <span style=color:#a6e22e>squareW</span>, <span style=color:#a6e22e>squareW</span>); 
</span></span><span style=display:flex><span>   <span style=color:#a6e22e>rect</span>(<span style=color:#f92672>-</span><span style=color:#a6e22e>squareW</span><span style=color:#f92672>/</span><span style=color:#ae81ff>3</span>, <span style=color:#f92672>-</span><span style=color:#a6e22e>squareW</span><span style=color:#f92672>/</span><span style=color:#ae81ff>3</span>, <span style=color:#a6e22e>squareW</span>, <span style=color:#a6e22e>squareW</span>); 
</span></span><span style=display:flex><span> }
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span> <span style=color:#a6e22e>rotationAngle</span> <span style=color:#f92672>+=</span> <span style=color:#ae81ff>1</span><span style=color:#f92672>/</span><span style=color:#ae81ff>5</span>; 
</span></span><span style=display:flex><span>}</span></span></code></pre></div></div></details><iframe id=moire_pattern1 style=width:430px;height:450px srcdoc="
        <!DOCTYPE html>
        <html>
          <head>
            <script src=https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.5.0/p5.min.js></script>
            <script src=https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.5.0/addons/p5.sound.min.js></script>
            
            
            
            
            
            <script src=/showcase/sketches/exercises/visual_illusions/moire_pattern1.js></script>
          </head>
          <body>
          </body>
        </html>
      "></iframe>
<details><summary>Moire Pattern 2</summary><div class=markdown-inner><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>numShapes</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>100</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>shapeSize</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>10</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>angle</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>setup</span>() {
</span></span><span style=display:flex><span> <span style=color:#a6e22e>createCanvas</span>(<span style=color:#ae81ff>400</span>, <span style=color:#ae81ff>400</span>);
</span></span><span style=display:flex><span> <span style=color:#a6e22e>numShapesInput</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>createInput</span>(<span style=color:#a6e22e>numShapes</span>);
</span></span><span style=display:flex><span> <span style=color:#a6e22e>numShapesInput</span>.<span style=color:#a6e22e>value</span>(<span style=color:#ae81ff>100</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span> <span style=color:#a6e22e>shapeSizesInput</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>createInput</span>(<span style=color:#a6e22e>shapeSize</span>);
</span></span><span style=display:flex><span> <span style=color:#a6e22e>shapeSizesInput</span>.<span style=color:#a6e22e>value</span>(<span style=color:#ae81ff>10</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span> <span style=color:#a6e22e>numShapesInput</span>.<span style=color:#a6e22e>input</span>(() =&gt; {
</span></span><span style=display:flex><span>   <span style=color:#a6e22e>numShapes</span> <span style=color:#f92672>=</span> parseInt(<span style=color:#a6e22e>numShapesInput</span>.<span style=color:#a6e22e>value</span>());
</span></span><span style=display:flex><span> });
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span> <span style=color:#a6e22e>shapeSizesInput</span>.<span style=color:#a6e22e>input</span>(() =&gt; {
</span></span><span style=display:flex><span>   <span style=color:#a6e22e>shapeSize</span> <span style=color:#f92672>=</span> parseInt(<span style=color:#a6e22e>shapeSizesInput</span>.<span style=color:#a6e22e>value</span>());
</span></span><span style=display:flex><span> });
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>draw</span>() {
</span></span><span style=display:flex><span> <span style=color:#a6e22e>background</span>(<span style=color:#ae81ff>220</span>);
</span></span><span style=display:flex><span> <span style=color:#a6e22e>noFill</span>();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span> <span style=color:#75715e>// Center the shapes in the canvas
</span></span></span><span style=display:flex><span><span style=color:#75715e></span> <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>centerX</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>width</span> <span style=color:#f92672>/</span> <span style=color:#ae81ff>2</span>;
</span></span><span style=display:flex><span> <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>centerY</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>height</span> <span style=color:#f92672>/</span> <span style=color:#ae81ff>2</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span> <span style=color:#75715e>// Draw a loop of triangles
</span></span></span><span style=display:flex><span><span style=color:#75715e></span> <span style=color:#a6e22e>stroke</span>(<span style=color:#e6db74>&#34;black&#34;</span>);
</span></span><span style=display:flex><span> <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>let</span> <span style=color:#a6e22e>i</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>; <span style=color:#a6e22e>i</span> <span style=color:#f92672>&lt;</span> <span style=color:#a6e22e>numShapes</span>; <span style=color:#a6e22e>i</span><span style=color:#f92672>++</span>) {
</span></span><span style=display:flex><span>   <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>triangleX</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>centerX</span>;
</span></span><span style=display:flex><span>   <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>triangleY</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>centerY</span>;
</span></span><span style=display:flex><span>   <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>triangleR</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>shapeSize</span> <span style=color:#f92672>*</span> (<span style=color:#a6e22e>numShapes</span> <span style=color:#f92672>-</span> <span style=color:#a6e22e>i</span>);
</span></span><span style=display:flex><span>   <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>triangleA</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>angle</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>i</span> <span style=color:#f92672>*</span> (<span style=color:#ae81ff>360</span> <span style=color:#f92672>/</span> <span style=color:#a6e22e>numShapes</span>);
</span></span><span style=display:flex><span>   <span style=color:#a6e22e>push</span>();
</span></span><span style=display:flex><span>   <span style=color:#a6e22e>translate</span>(<span style=color:#a6e22e>triangleX</span>, <span style=color:#a6e22e>triangleY</span>);
</span></span><span style=display:flex><span>   <span style=color:#a6e22e>rotate</span>(<span style=color:#a6e22e>radians</span>(<span style=color:#a6e22e>triangleA</span>));
</span></span><span style=display:flex><span>   <span style=color:#a6e22e>triangle</span>(<span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#a6e22e>triangleR</span>, <span style=color:#a6e22e>triangleR</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>sqrt</span>(<span style=color:#ae81ff>3</span>) <span style=color:#f92672>/</span> <span style=color:#ae81ff>2</span>, <span style=color:#f92672>-</span><span style=color:#a6e22e>triangleR</span>, <span style=color:#a6e22e>triangleR</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>sqrt</span>(<span style=color:#ae81ff>3</span>) <span style=color:#f92672>/</span> <span style=color:#ae81ff>2</span>);
</span></span><span style=display:flex><span>   <span style=color:#a6e22e>pop</span>();
</span></span><span style=display:flex><span> }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span> <span style=color:#75715e>// Draw a loop of squares
</span></span></span><span style=display:flex><span><span style=color:#75715e></span> <span style=color:#a6e22e>stroke</span>(<span style=color:#e6db74>&#34;black&#34;</span>);
</span></span><span style=display:flex><span> <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>let</span> <span style=color:#a6e22e>i</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>; <span style=color:#a6e22e>i</span> <span style=color:#f92672>&lt;</span> <span style=color:#a6e22e>numShapes</span>; <span style=color:#a6e22e>i</span><span style=color:#f92672>++</span>) {
</span></span><span style=display:flex><span>   <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>squareX</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>centerX</span>;
</span></span><span style=display:flex><span>   <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>squareY</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>centerY</span>;
</span></span><span style=display:flex><span>   <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>squareW</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>shapeSize</span> <span style=color:#f92672>*</span> (<span style=color:#a6e22e>numShapes</span> <span style=color:#f92672>-</span> <span style=color:#a6e22e>i</span>);
</span></span><span style=display:flex><span>   <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>squareA</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>angle</span> <span style=color:#f92672>-</span> <span style=color:#a6e22e>i</span> <span style=color:#f92672>*</span> (<span style=color:#ae81ff>360</span> <span style=color:#f92672>/</span> <span style=color:#a6e22e>numShapes</span>);
</span></span><span style=display:flex><span>   <span style=color:#a6e22e>push</span>();
</span></span><span style=display:flex><span>   <span style=color:#a6e22e>translate</span>(<span style=color:#a6e22e>squareX</span>, <span style=color:#a6e22e>squareY</span>);
</span></span><span style=display:flex><span>   <span style=color:#a6e22e>rotate</span>(<span style=color:#a6e22e>radians</span>(<span style=color:#a6e22e>squareA</span>));
</span></span><span style=display:flex><span>   <span style=color:#a6e22e>rectMode</span>(<span style=color:#a6e22e>CENTER</span>);
</span></span><span style=display:flex><span>   <span style=color:#a6e22e>rect</span>(<span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#a6e22e>squareW</span>, <span style=color:#a6e22e>squareW</span>);
</span></span><span style=display:flex><span>   <span style=color:#a6e22e>pop</span>();
</span></span><span style=display:flex><span> }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span> <span style=color:#a6e22e>angle</span> <span style=color:#f92672>+=</span> <span style=color:#ae81ff>1</span>;
</span></span><span style=display:flex><span>}</span></span></code></pre></div></div></details><iframe id=moire_pattern2 style=width:430px;height:450px srcdoc="
        <!DOCTYPE html>
        <html>
          <head>
            <script src=https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.5.0/p5.min.js></script>
            <script src=https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.5.0/addons/p5.sound.min.js></script>
            
            
            
            
            
            <script src=/showcase/sketches/exercises/visual_illusions/moire_pattern2.js></script>
          </head>
          <body>
          </body>
        </html>
      "></iframe><h1 id=floyd-steinberg-dithering>Floyd-Steinberg dithering
<a class=anchor href=#floyd-steinberg-dithering>#</a></h1><blockquote><p><strong>Prompt:</strong> Implement a color mapping application that helps people who are color blind see the colors around them.</p></blockquote><p>Dithering is, a it´s core, a form of noise that is applied to a medium (either sound or an image) and it´s used to prevent certain color problems when used in image processing or as a means to compress audio.
<img src=https://upload.wikimedia.org/wikipedia/commons/7/71/Michelangelo%27s_David_-_63_grijswaarden.png alt="Image od David using dithering">
<img src=https://upload.wikimedia.org/wikipedia/commons/c/c1/Michelangelo%27s_David_-_Floyd-Steinberg.png alt="Image od David using dithering">
Dithering in image processing can be achieved by many different ways, but in this case we´re focusing on the <em><strong>Floyd-Steinberg algorithm for image dithering</strong></em>. To understand this algorithm fyllu it is necessary to break it in a couple of portions:</p><h2 id=quantizing>Quantizing
<a class=anchor href=#quantizing>#</a></h2><p>Quantizing in the image processing scope, is a process in wich the image is divided into individual pixels and each and every one of them is filtered through their respective red, green and blue channels. But first it´s necessary to trace every pixel´s position in the image, a helpfull way to think about it is like a grid of pixels, where every pixel has a (x,y) location to it:</p><table><thead><tr><th>0</th><th>1</th><th>2</th><th>3</th></tr></thead><tbody><tr><td>1</td><td>x</td><td>x</td><td>x</td></tr><tr><td>2</td><td>x</td><td>x</td><td>x</td></tr><tr><td>3</td><td>x</td><td>x</td><td>x</td></tr></tbody></table><p>Now, after every pixel has it´s coordinates we can filter every individual pixel through every color channel limiting the available number of colors it can take: For example, if we take an RGB color as a number between 0 and 255, if we limit the colors to only two 0 or 255 (black and white), if a color value on any channel is les than 127, the pixel will round down to 0 and it´ll take the color black. On the other hand, if the value is greater than 127, the pixel will round up to 255 and take the color white. This very thing happens if the color spectrum goes from 2 possibilities to 5, or 125, etc.</p><p>There´s something to keep in mind, every time dithering is applied to an image there´s an error that is being generated. This error can be used and spread through the pixel´s neighbours to have a more detailed image withoud much fidelity loss.</p><h2 id=quantizing-error>Quantizing error
<a class=anchor href=#quantizing-error>#</a></h2><p>To quantize the error and incorporate it into the the image processing, first we just need to do a simple substraction. The operation consists of substracting the original value of the color channel from the quantized value , the result is the error_
<img src="https://drive.google.com/uc?id=1eMAOO7M0OAzqzBeb3wfbp7UMACtWlC-T" alt="Image od David using dithering">
Now, finnaly it´s time for the <strong>Floyd-Steinberg algorithm</strong>.</p><h2 id=floyd-steinberg-algorithm>Floyd-Steinberg algorithm
<a class=anchor href=#floyd-steinberg-algorithm>#</a></h2><p>This algorithm focuses on &ldquo;streching&rdquo; or dispersing the error to the neighboring pixels, this is achieved by the use of this small pseudo-code and better explaine by this graph:</p><pre><code>	pixels[_x_ + 1][_y_    ] := pixels[_x_ + 1][_y_    ] + quant_error × 7 / 16
	pixels[_x_ - 1][_y_ + 1] := pixels[_x_ - 1][_y_ + 1] + quant_error × 3 / 16
    pixels[_x_    ][_y_ + 1] := pixels[_x_    ][_y_ + 1] + quant_error × 5 / 16
    pixels[_x_ + 1][_y_ + 1] := pixels[_x_ + 1][_y_ + 1] + quant_error × 1 / 16
</code></pre><p><img src="https://drive.google.com/uc?id=1036PgQPB7gMR0iT2Khd-yPTgMCuoCQ2R" alt="Image od David using dithering"></p><p>Here the error &ldquo;spreads&rdquo; in different directions with different rates, thats why the pixel indexing was so important.</p><p>After having the quantized error calculated and embeded into the algorithm it´s time to put back all the pixels and reveal the waited result!</p><h1 id=floyd-steinberg-dithering-1>Floyd-Steinberg dithering
<a class=anchor href=#floyd-steinberg-dithering-1>#</a></h1><blockquote><p><strong>Prompt:</strong> Implement a color mapping application that helps people who are color blind see the colors around them.</p></blockquote><p>Dithering is, a it´s core, a form of noise that is applied to a medium (either sound or an image) and it´s used to prevent certain color problems when used in image processing or as a means to compress audio.
<img src=https://upload.wikimedia.org/wikipedia/commons/7/71/Michelangelo%27s_David_-_63_grijswaarden.png alt="Image od David using dithering">
<img src=https://upload.wikimedia.org/wikipedia/commons/c/c1/Michelangelo%27s_David_-_Floyd-Steinberg.png alt="Image od David using dithering">
Dithering in image processing can be achieved by many different ways, but in this case we´re focusing on the <em><strong>Floyd-Steinberg algorithm for image dithering</strong></em>. To understand this algorithm fyllu it is necessary to break it in a couple of portions:</p><h2 id=quantizing-1>Quantizing
<a class=anchor href=#quantizing-1>#</a></h2><p>Quantizing in the image processing scope, is a process in wich the image is divided into individual pixels and each and every one of them is filtered through their respective red, green and blue channels. But first it´s necessary to trace every pixel´s position in the image, a helpfull way to think about it is like a grid of pixels, where every pixel has a (x,y) location to it:</p><table><thead><tr><th>0</th><th>1</th><th>2</th><th>3</th></tr></thead><tbody><tr><td>1</td><td>x</td><td>x</td><td>x</td></tr><tr><td>2</td><td>x</td><td>x</td><td>x</td></tr><tr><td>3</td><td>x</td><td>x</td><td>x</td></tr></tbody></table><p>Now, after every pixel has it´s coordinates we can filter every individual pixel through every color channel limiting the available number of colors it can take: For example, if we take an RGB color as a number between 0 and 255, if we limit the colors to only two 0 or 255 (black and white), if a color value on any channel is les than 127, the pixel will round down to 0 and it´ll take the color black. On the other hand, if the value is greater than 127, the pixel will round up to 255 and take the color white. This very thing happens if the color spectrum goes from 2 possibilities to 5, or 125, etc.</p><p>There´s something to keep in mind, every time dithering is applied to an image there´s an error that is being generated. This error can be used and spread through the pixel´s neighbours to have a more detailed image withoud much fidelity loss.</p><h2 id=quantizing-error-1>Quantizing error
<a class=anchor href=#quantizing-error-1>#</a></h2><p>To quantize the error and incorporate it into the the image processing, first we just need to do a simple substraction. The operation consists of substracting the original value of the color channel from the quantized value , the result is the error_
<img src="https://drive.google.com/uc?id=1eMAOO7M0OAzqzBeb3wfbp7UMACtWlC-T" alt="Image od David using dithering">
Now, finnaly it´s time for the <strong>Floyd-Steinberg algorithm</strong>.</p><h2 id=floyd-steinberg-algorithm-1>Floyd-Steinberg algorithm
<a class=anchor href=#floyd-steinberg-algorithm-1>#</a></h2><p>This algorithm focuses on &ldquo;streching&rdquo; or dispersing the error to the neighboring pixels, this is achieved by the use of this small pseudo-code and better explaine by this graph:</p><pre><code>	pixels[_x_ + 1][_y_    ] := pixels[_x_ + 1][_y_    ] + quant_error × 7 / 16
	pixels[_x_ - 1][_y_ + 1] := pixels[_x_ - 1][_y_ + 1] + quant_error × 3 / 16
    pixels[_x_    ][_y_ + 1] := pixels[_x_    ][_y_ + 1] + quant_error × 5 / 16
    pixels[_x_ + 1][_y_ + 1] := pixels[_x_ + 1][_y_ + 1] + quant_error × 1 / 16
</code></pre><p><img src="https://drive.google.com/uc?id=1036PgQPB7gMR0iT2Khd-yPTgMCuoCQ2R" alt="Image od David using dithering"></p><p>Here the error &ldquo;spreads&rdquo; in different directions with different rates, thats why the pixel indexing was so important.</p><p>After having the quantized error calculated and embeded into the algorithm it´s time to put back all the pixels and reveal the waited result!</p><iframe id=1 style=width:760px;height:780px srcdoc="
        <!DOCTYPE html>
        <html>
          <head>
            <script src=https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.5.0/p5.min.js></script>
            <script src=https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.5.0/addons/p5.sound.min.js></script>
            
            
            
            
            
            <script src=/showcase/sketches/exercises/dithering/1.js></script>
          </head>
          <body>
          </body>
        </html>
      "></iframe><h2 id=web-app>Web app
<a class=anchor href=#web-app>#</a></h2><blockquote><p><strong>Prompt:</strong> Implement in software an image processing web app supporting different <a href=https://en.wikipedia.org/wiki/Kernel_%28image_processing%29>image kernels</a> and supporting:</p></blockquote><ul><li><a href=https://en.wikipedia.org/wiki/Image_histogram>Image histogram</a> visualization.</li><li>Different <a href=https://en.wikipedia.org/wiki/HSL_and_HSV#Lightness>lightness</a> (coloring brightness) tools.</li></ul><blockquote></blockquote><p>On this exercise we provide a script to process images that can be embeded on any web application. But for practical purposes we show an example with predefined images.</p><p>The next p5 script allow us to load an image from our computer, then generates the histogram for the image and finally one can choose from various processes that can be applied to that image, when a process is applied the resulting image is automatically downloaded.</p><details><summary>web-app.js</summary><div class=markdown-inner><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>HW</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>400</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>HH</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>400</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>HP</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>200</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>BG</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>8</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>drawRGBHistogram</span>(<span style=color:#a6e22e>imgBuffer</span>) {
</span></span><span style=display:flex><span> <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>histR</span> <span style=color:#f92672>=</span> (<span style=color:#66d9ef>new</span> Array(<span style=color:#ae81ff>256</span>)).<span style=color:#a6e22e>fill</span>(<span style=color:#ae81ff>0</span>);
</span></span><span style=display:flex><span> <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>histG</span> <span style=color:#f92672>=</span> (<span style=color:#66d9ef>new</span> Array(<span style=color:#ae81ff>256</span>)).<span style=color:#a6e22e>fill</span>(<span style=color:#ae81ff>0</span>);
</span></span><span style=display:flex><span> <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>histB</span> <span style=color:#f92672>=</span> (<span style=color:#66d9ef>new</span> Array(<span style=color:#ae81ff>256</span>)).<span style=color:#a6e22e>fill</span>(<span style=color:#ae81ff>0</span>);
</span></span><span style=display:flex><span> <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>maxB</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span> <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>let</span> <span style=color:#a6e22e>i</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>; <span style=color:#a6e22e>i</span> <span style=color:#f92672>&lt;</span> <span style=color:#a6e22e>imgBuffer</span>.<span style=color:#a6e22e>length</span>; <span style=color:#a6e22e>i</span> <span style=color:#f92672>+=</span> <span style=color:#ae81ff>4</span>) {
</span></span><span style=display:flex><span>   <span style=color:#a6e22e>histR</span>[<span style=color:#a6e22e>imgBuffer</span>[<span style=color:#a6e22e>i</span>]]<span style=color:#f92672>++</span>;
</span></span><span style=display:flex><span>   <span style=color:#a6e22e>histG</span>[<span style=color:#a6e22e>imgBuffer</span>[<span style=color:#a6e22e>i</span> <span style=color:#f92672>+</span> <span style=color:#ae81ff>1</span>]]<span style=color:#f92672>++</span>;
</span></span><span style=display:flex><span>   <span style=color:#a6e22e>histB</span>[<span style=color:#a6e22e>imgBuffer</span>[<span style=color:#a6e22e>i</span> <span style=color:#f92672>+</span> <span style=color:#ae81ff>2</span>]]<span style=color:#f92672>++</span>;
</span></span><span style=display:flex><span> }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span> <span style=color:#a6e22e>maxB</span> <span style=color:#f92672>=</span> Math.<span style=color:#a6e22e>max</span>(Math.<span style=color:#a6e22e>max</span>(...<span style=color:#a6e22e>histR</span>), Math.<span style=color:#a6e22e>max</span>(...<span style=color:#a6e22e>histG</span>), Math.<span style=color:#a6e22e>max</span>(...<span style=color:#a6e22e>histB</span>));
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span> <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>y1</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>HP</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>HH</span>;
</span></span><span style=display:flex><span> <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>dx</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>HW</span> <span style=color:#f92672>/</span> <span style=color:#ae81ff>255</span>;
</span></span><span style=display:flex><span> <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>dy</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>HW</span> <span style=color:#f92672>/</span> <span style=color:#a6e22e>maxB</span>;
</span></span><span style=display:flex><span> <span style=color:#a6e22e>rect</span>(<span style=color:#ae81ff>0</span>, <span style=color:#a6e22e>HP</span>, <span style=color:#a6e22e>HW</span>, <span style=color:#a6e22e>HH</span>);
</span></span><span style=display:flex><span> <span style=color:#a6e22e>strokeWeight</span>(<span style=color:#a6e22e>dx</span>);
</span></span><span style=display:flex><span>   
</span></span><span style=display:flex><span> <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>let</span> <span style=color:#a6e22e>i</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>; <span style=color:#a6e22e>i</span> <span style=color:#f92672>&lt;</span> <span style=color:#ae81ff>256</span>; <span style=color:#a6e22e>i</span><span style=color:#f92672>++</span>) {
</span></span><span style=display:flex><span>   <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>x</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>i</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>dx</span>;
</span></span><span style=display:flex><span>   <span style=color:#a6e22e>stroke</span>(<span style=color:#a6e22e>color</span>(<span style=color:#ae81ff>220</span>,<span style=color:#ae81ff>0</span>,<span style=color:#ae81ff>0</span>,<span style=color:#ae81ff>128</span>));
</span></span><span style=display:flex><span>   <span style=color:#a6e22e>line</span>(<span style=color:#a6e22e>x</span>, <span style=color:#a6e22e>y1</span>, <span style=color:#a6e22e>x</span>, <span style=color:#a6e22e>y1</span> <span style=color:#f92672>-</span> <span style=color:#a6e22e>histR</span>[<span style=color:#a6e22e>i</span>] <span style=color:#f92672>*</span> <span style=color:#a6e22e>dy</span>);
</span></span><span style=display:flex><span>   <span style=color:#a6e22e>stroke</span>(<span style=color:#a6e22e>color</span>(<span style=color:#ae81ff>0</span>,<span style=color:#ae81ff>210</span>,<span style=color:#ae81ff>0</span>,<span style=color:#ae81ff>128</span>));
</span></span><span style=display:flex><span>   <span style=color:#a6e22e>line</span>(<span style=color:#a6e22e>x</span>, <span style=color:#a6e22e>y1</span>, <span style=color:#a6e22e>x</span>, <span style=color:#a6e22e>y1</span> <span style=color:#f92672>-</span> <span style=color:#a6e22e>histG</span>[<span style=color:#a6e22e>i</span>] <span style=color:#f92672>*</span> <span style=color:#a6e22e>dy</span>);
</span></span><span style=display:flex><span>   <span style=color:#a6e22e>stroke</span>(<span style=color:#a6e22e>color</span>(<span style=color:#ae81ff>0</span>,<span style=color:#ae81ff>0</span>,<span style=color:#ae81ff>255</span>,<span style=color:#ae81ff>128</span>));
</span></span><span style=display:flex><span>   <span style=color:#a6e22e>line</span>(<span style=color:#a6e22e>x</span>, <span style=color:#a6e22e>y1</span>, <span style=color:#a6e22e>x</span>, <span style=color:#a6e22e>y1</span> <span style=color:#f92672>-</span> <span style=color:#a6e22e>histB</span>[<span style=color:#a6e22e>i</span>] <span style=color:#f92672>*</span> <span style=color:#a6e22e>dy</span>);
</span></span><span style=display:flex><span>   <span style=color:#a6e22e>stroke</span>(<span style=color:#a6e22e>color</span>(<span style=color:#a6e22e>i</span>, <span style=color:#a6e22e>i</span>, <span style=color:#a6e22e>i</span>));
</span></span><span style=display:flex><span>   <span style=color:#a6e22e>line</span>(<span style=color:#a6e22e>x</span>, <span style=color:#a6e22e>y1</span>, <span style=color:#a6e22e>x</span>, <span style=color:#a6e22e>y1</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>BG</span>);
</span></span><span style=display:flex><span> }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>drawBrightnessHistogram</span>(<span style=color:#a6e22e>imgBuffer</span>) {
</span></span><span style=display:flex><span> <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>hist</span> <span style=color:#f92672>=</span> (<span style=color:#66d9ef>new</span> Array(<span style=color:#ae81ff>256</span>)).<span style=color:#a6e22e>fill</span>(<span style=color:#ae81ff>0</span>);
</span></span><span style=display:flex><span> <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>maxB</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span> <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>let</span> <span style=color:#a6e22e>i</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>; <span style=color:#a6e22e>i</span> <span style=color:#f92672>&lt;</span> <span style=color:#a6e22e>imgBuffer</span>.<span style=color:#a6e22e>length</span>; <span style=color:#a6e22e>i</span><span style=color:#f92672>++</span>) {
</span></span><span style=display:flex><span>   <span style=color:#75715e>// Ignoring alpha
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>   <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>i</span><span style=color:#f92672>%</span><span style=color:#ae81ff>4</span> <span style=color:#f92672>!=</span> <span style=color:#ae81ff>3</span>) {
</span></span><span style=display:flex><span>     <span style=color:#a6e22e>hist</span>[<span style=color:#a6e22e>imgBuffer</span>[<span style=color:#a6e22e>i</span>]]<span style=color:#f92672>++</span>;
</span></span><span style=display:flex><span>   }
</span></span><span style=display:flex><span> }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span> <span style=color:#a6e22e>maxB</span> <span style=color:#f92672>=</span> Math.<span style=color:#a6e22e>max</span>(...<span style=color:#a6e22e>hist</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span> <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>y1</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>HP</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>HH</span>;
</span></span><span style=display:flex><span> <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>dx</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>HW</span> <span style=color:#f92672>/</span> <span style=color:#ae81ff>255</span>;
</span></span><span style=display:flex><span> <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>dy</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>HW</span> <span style=color:#f92672>/</span> <span style=color:#a6e22e>maxB</span>;
</span></span><span style=display:flex><span> <span style=color:#a6e22e>rect</span>(<span style=color:#ae81ff>0</span>, <span style=color:#a6e22e>HP</span>, <span style=color:#a6e22e>HW</span>, <span style=color:#a6e22e>HH</span>);
</span></span><span style=display:flex><span> <span style=color:#a6e22e>strokeWeight</span>(<span style=color:#a6e22e>dx</span>);
</span></span><span style=display:flex><span>   
</span></span><span style=display:flex><span> <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>let</span> <span style=color:#a6e22e>i</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>; <span style=color:#a6e22e>i</span> <span style=color:#f92672>&lt;</span> <span style=color:#ae81ff>256</span>; <span style=color:#a6e22e>i</span><span style=color:#f92672>++</span>) {
</span></span><span style=display:flex><span>   <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>x</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>i</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>dx</span>;
</span></span><span style=display:flex><span>   <span style=color:#a6e22e>stroke</span>(<span style=color:#a6e22e>color</span>(<span style=color:#e6db74>&#34;black&#34;</span>));
</span></span><span style=display:flex><span>   <span style=color:#a6e22e>line</span>(<span style=color:#a6e22e>x</span>, <span style=color:#a6e22e>y1</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>BG</span>, <span style=color:#a6e22e>x</span>, <span style=color:#a6e22e>y1</span> <span style=color:#f92672>-</span> <span style=color:#a6e22e>hist</span>[<span style=color:#a6e22e>i</span>] <span style=color:#f92672>*</span> <span style=color:#a6e22e>dy</span>);
</span></span><span style=display:flex><span>   <span style=color:#a6e22e>stroke</span>(<span style=color:#a6e22e>color</span>(<span style=color:#a6e22e>i</span>, <span style=color:#a6e22e>i</span>, <span style=color:#a6e22e>i</span>));
</span></span><span style=display:flex><span>   <span style=color:#a6e22e>line</span>(<span style=color:#a6e22e>x</span>, <span style=color:#a6e22e>y1</span>, <span style=color:#a6e22e>x</span>, <span style=color:#a6e22e>y1</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>BG</span>);
</span></span><span style=display:flex><span> }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>copyArray</span>(<span style=color:#a6e22e>a</span>) {
</span></span><span style=display:flex><span> <span style=color:#a6e22e>c</span> <span style=color:#f92672>=</span> Array(<span style=color:#a6e22e>a</span>.<span style=color:#a6e22e>length</span>); 
</span></span><span style=display:flex><span> <span style=color:#a6e22e>i</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>a</span>.<span style=color:#a6e22e>length</span>;
</span></span><span style=display:flex><span> <span style=color:#66d9ef>while</span>(<span style=color:#a6e22e>i</span><span style=color:#f92672>--</span>) <span style=color:#a6e22e>c</span>[<span style=color:#a6e22e>i</span>] <span style=color:#f92672>=</span> <span style=color:#a6e22e>a</span>[<span style=color:#a6e22e>i</span>];
</span></span><span style=display:flex><span> <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>a</span>;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>applyLuma</span>(){
</span></span><span style=display:flex><span> <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>lumaImg</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>createImage</span>(<span style=color:#a6e22e>img</span>.<span style=color:#a6e22e>width</span>, <span style=color:#a6e22e>img</span>.<span style=color:#a6e22e>height</span>);
</span></span><span style=display:flex><span> <span style=color:#a6e22e>lumaImg</span>.<span style=color:#a6e22e>loadPixels</span>();
</span></span><span style=display:flex><span> <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>let</span> <span style=color:#a6e22e>i</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>; <span style=color:#a6e22e>i</span> <span style=color:#f92672>&lt;</span> <span style=color:#a6e22e>img</span>.<span style=color:#a6e22e>pixels</span>.<span style=color:#a6e22e>length</span>; <span style=color:#a6e22e>i</span><span style=color:#f92672>+=</span><span style=color:#ae81ff>4</span>) {
</span></span><span style=display:flex><span>   <span style=color:#a6e22e>lumaImg</span>.<span style=color:#a6e22e>pixels</span>[<span style=color:#a6e22e>i</span>] <span style=color:#f92672>=</span> (<span style=color:#a6e22e>img</span>.<span style=color:#a6e22e>pixels</span>[<span style=color:#a6e22e>i</span>] <span style=color:#f92672>+</span> <span style=color:#a6e22e>img</span>.<span style=color:#a6e22e>pixels</span>[<span style=color:#a6e22e>i</span> <span style=color:#f92672>+</span> <span style=color:#ae81ff>1</span>] <span style=color:#f92672>+</span> <span style=color:#a6e22e>img</span>.<span style=color:#a6e22e>pixels</span>[<span style=color:#a6e22e>i</span> <span style=color:#f92672>+</span> <span style=color:#ae81ff>2</span>]) <span style=color:#f92672>/</span> <span style=color:#ae81ff>3</span>;
</span></span><span style=display:flex><span>   <span style=color:#a6e22e>lumaImg</span>.<span style=color:#a6e22e>pixels</span>[<span style=color:#a6e22e>i</span> <span style=color:#f92672>+</span> <span style=color:#ae81ff>1</span>] <span style=color:#f92672>=</span> (<span style=color:#a6e22e>img</span>.<span style=color:#a6e22e>pixels</span>[<span style=color:#a6e22e>i</span>] <span style=color:#f92672>+</span> <span style=color:#a6e22e>img</span>.<span style=color:#a6e22e>pixels</span>[<span style=color:#a6e22e>i</span> <span style=color:#f92672>+</span> <span style=color:#ae81ff>1</span>] <span style=color:#f92672>+</span> <span style=color:#a6e22e>img</span>.<span style=color:#a6e22e>pixels</span>[<span style=color:#a6e22e>i</span> <span style=color:#f92672>+</span> <span style=color:#ae81ff>2</span>]) <span style=color:#f92672>/</span> <span style=color:#ae81ff>3</span>;
</span></span><span style=display:flex><span>   <span style=color:#a6e22e>lumaImg</span>.<span style=color:#a6e22e>pixels</span>[<span style=color:#a6e22e>i</span> <span style=color:#f92672>+</span> <span style=color:#ae81ff>2</span>] <span style=color:#f92672>=</span> (<span style=color:#a6e22e>img</span>.<span style=color:#a6e22e>pixels</span>[<span style=color:#a6e22e>i</span>] <span style=color:#f92672>+</span> <span style=color:#a6e22e>img</span>.<span style=color:#a6e22e>pixels</span>[<span style=color:#a6e22e>i</span> <span style=color:#f92672>+</span> <span style=color:#ae81ff>1</span>] <span style=color:#f92672>+</span> <span style=color:#a6e22e>img</span>.<span style=color:#a6e22e>pixels</span>[<span style=color:#a6e22e>i</span> <span style=color:#f92672>+</span> <span style=color:#ae81ff>2</span>]) <span style=color:#f92672>/</span> <span style=color:#ae81ff>3</span>;
</span></span><span style=display:flex><span>   <span style=color:#a6e22e>lumaImg</span>.<span style=color:#a6e22e>pixels</span>[<span style=color:#a6e22e>i</span> <span style=color:#f92672>+</span> <span style=color:#ae81ff>3</span>] <span style=color:#f92672>=</span> <span style=color:#ae81ff>255</span>;
</span></span><span style=display:flex><span> }
</span></span><span style=display:flex><span> <span style=color:#a6e22e>lumaImg</span>.<span style=color:#a6e22e>updatePixels</span>();
</span></span><span style=display:flex><span> <span style=color:#a6e22e>lumaImg</span>.<span style=color:#a6e22e>save</span>(<span style=color:#e6db74>&#39;luma&#39;</span>, <span style=color:#e6db74>&#39;png&#39;</span>);
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>convolve</span>(<span style=color:#a6e22e>name</span>, <span style=color:#a6e22e>matrix</span>) {
</span></span><span style=display:flex><span> <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>convolvedImage</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>createImage</span>(<span style=color:#a6e22e>img</span>.<span style=color:#a6e22e>width</span>, <span style=color:#a6e22e>img</span>.<span style=color:#a6e22e>height</span>);
</span></span><span style=display:flex><span> <span style=color:#a6e22e>convolvedImage</span>.<span style=color:#a6e22e>loadPixels</span>();
</span></span><span style=display:flex><span> <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>let</span> <span style=color:#a6e22e>x</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>; <span style=color:#a6e22e>x</span> <span style=color:#f92672>&lt;</span> <span style=color:#a6e22e>img</span>.<span style=color:#a6e22e>width</span>; <span style=color:#a6e22e>x</span><span style=color:#f92672>++</span>) {
</span></span><span style=display:flex><span>   <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>let</span> <span style=color:#a6e22e>y</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>; <span style=color:#a6e22e>y</span> <span style=color:#f92672>&lt;</span> <span style=color:#a6e22e>img</span>.<span style=color:#a6e22e>height</span>; <span style=color:#a6e22e>y</span><span style=color:#f92672>++</span>) {
</span></span><span style=display:flex><span>     <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>c</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>convolution</span>(<span style=color:#a6e22e>x</span>, <span style=color:#a6e22e>y</span>, <span style=color:#a6e22e>matrix</span>, <span style=color:#a6e22e>img</span>);
</span></span><span style=display:flex><span>     
</span></span><span style=display:flex><span>     <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>loc</span> <span style=color:#f92672>=</span> (<span style=color:#a6e22e>x</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>y</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>img</span>.<span style=color:#a6e22e>width</span>) <span style=color:#f92672>*</span> <span style=color:#ae81ff>4</span>;
</span></span><span style=display:flex><span>     <span style=color:#a6e22e>convolvedImage</span>.<span style=color:#a6e22e>pixels</span>[<span style=color:#a6e22e>loc</span>] <span style=color:#f92672>=</span> <span style=color:#a6e22e>red</span>(<span style=color:#a6e22e>c</span>);
</span></span><span style=display:flex><span>     <span style=color:#a6e22e>convolvedImage</span>.<span style=color:#a6e22e>pixels</span>[<span style=color:#a6e22e>loc</span> <span style=color:#f92672>+</span> <span style=color:#ae81ff>1</span>] <span style=color:#f92672>=</span> <span style=color:#a6e22e>green</span>(<span style=color:#a6e22e>c</span>);
</span></span><span style=display:flex><span>     <span style=color:#a6e22e>convolvedImage</span>.<span style=color:#a6e22e>pixels</span>[<span style=color:#a6e22e>loc</span> <span style=color:#f92672>+</span> <span style=color:#ae81ff>2</span>] <span style=color:#f92672>=</span> <span style=color:#a6e22e>blue</span>(<span style=color:#a6e22e>c</span>);
</span></span><span style=display:flex><span>     <span style=color:#a6e22e>convolvedImage</span>.<span style=color:#a6e22e>pixels</span>[<span style=color:#a6e22e>loc</span> <span style=color:#f92672>+</span> <span style=color:#ae81ff>3</span>] <span style=color:#f92672>=</span> <span style=color:#a6e22e>alpha</span>(<span style=color:#a6e22e>c</span>);
</span></span><span style=display:flex><span>   }
</span></span><span style=display:flex><span> }
</span></span><span style=display:flex><span> <span style=color:#a6e22e>convolvedImage</span>.<span style=color:#a6e22e>updatePixels</span>();
</span></span><span style=display:flex><span> <span style=color:#a6e22e>convolvedImage</span>.<span style=color:#a6e22e>save</span>(<span style=color:#a6e22e>name</span>, <span style=color:#e6db74>&#39;png&#39;</span>);
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>convolution</span>(<span style=color:#a6e22e>x</span>, <span style=color:#a6e22e>y</span>, <span style=color:#a6e22e>matrix</span>) {
</span></span><span style=display:flex><span> <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>rtotal</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0.0</span>;
</span></span><span style=display:flex><span> <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>gtotal</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0.0</span>;
</span></span><span style=display:flex><span> <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>btotal</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0.0</span>;
</span></span><span style=display:flex><span> <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>offset</span> <span style=color:#f92672>=</span> Math.<span style=color:#a6e22e>floor</span>(<span style=color:#a6e22e>matrix</span>.<span style=color:#a6e22e>length</span> <span style=color:#f92672>/</span> <span style=color:#ae81ff>2</span>);
</span></span><span style=display:flex><span> <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>let</span> <span style=color:#a6e22e>i</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>; <span style=color:#a6e22e>i</span> <span style=color:#f92672>&lt;</span> <span style=color:#a6e22e>matrix</span>.<span style=color:#a6e22e>length</span>; <span style=color:#a6e22e>i</span><span style=color:#f92672>++</span>){
</span></span><span style=display:flex><span>   <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>let</span> <span style=color:#a6e22e>j</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>; <span style=color:#a6e22e>j</span> <span style=color:#f92672>&lt;</span> <span style=color:#a6e22e>matrix</span>.<span style=color:#a6e22e>length</span>; <span style=color:#a6e22e>j</span><span style=color:#f92672>++</span>){
</span></span><span style=display:flex><span>     
</span></span><span style=display:flex><span>     <span style=color:#75715e>// What pixel are we testing
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>     <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>xloc</span> <span style=color:#f92672>=</span> (<span style=color:#a6e22e>x</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>i</span> <span style=color:#f92672>-</span> <span style=color:#a6e22e>offset</span>);
</span></span><span style=display:flex><span>     <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>yloc</span> <span style=color:#f92672>=</span> (<span style=color:#a6e22e>y</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>j</span> <span style=color:#f92672>-</span> <span style=color:#a6e22e>offset</span>);
</span></span><span style=display:flex><span>     <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>loc</span> <span style=color:#f92672>=</span> (<span style=color:#a6e22e>xloc</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>yloc</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>img</span>.<span style=color:#a6e22e>width</span>) <span style=color:#f92672>*</span> <span style=color:#ae81ff>4</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>     <span style=color:#75715e>// Make sure we haven&#39;t walked off our image, we could do better here
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>     <span style=color:#a6e22e>loc</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>constrain</span>(<span style=color:#a6e22e>loc</span>, <span style=color:#ae81ff>0</span> , <span style=color:#a6e22e>img</span>.<span style=color:#a6e22e>pixels</span>.<span style=color:#a6e22e>length</span> <span style=color:#f92672>-</span> <span style=color:#ae81ff>1</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>     <span style=color:#75715e>// Calculate the convolution
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>     <span style=color:#75715e>// retrieve RGB values
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>     <span style=color:#a6e22e>rtotal</span> <span style=color:#f92672>+=</span> (<span style=color:#a6e22e>img</span>.<span style=color:#a6e22e>pixels</span>[<span style=color:#a6e22e>loc</span>]) <span style=color:#f92672>*</span> <span style=color:#a6e22e>matrix</span>[<span style=color:#a6e22e>i</span>][<span style=color:#a6e22e>j</span>];
</span></span><span style=display:flex><span>     <span style=color:#a6e22e>gtotal</span> <span style=color:#f92672>+=</span> (<span style=color:#a6e22e>img</span>.<span style=color:#a6e22e>pixels</span>[<span style=color:#a6e22e>loc</span> <span style=color:#f92672>+</span> <span style=color:#ae81ff>1</span>]) <span style=color:#f92672>*</span> <span style=color:#a6e22e>matrix</span>[<span style=color:#a6e22e>i</span>][<span style=color:#a6e22e>j</span>];
</span></span><span style=display:flex><span>     <span style=color:#a6e22e>btotal</span> <span style=color:#f92672>+=</span> (<span style=color:#a6e22e>img</span>.<span style=color:#a6e22e>pixels</span>[<span style=color:#a6e22e>loc</span> <span style=color:#f92672>+</span> <span style=color:#ae81ff>2</span>]) <span style=color:#f92672>*</span> <span style=color:#a6e22e>matrix</span>[<span style=color:#a6e22e>i</span>][<span style=color:#a6e22e>j</span>];
</span></span><span style=display:flex><span>   }
</span></span><span style=display:flex><span> }
</span></span><span style=display:flex><span> <span style=color:#75715e>// Make sure RGB is within range
</span></span></span><span style=display:flex><span><span style=color:#75715e></span> <span style=color:#a6e22e>rtotal</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>constrain</span>(<span style=color:#a6e22e>rtotal</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>255</span>);
</span></span><span style=display:flex><span> <span style=color:#a6e22e>gtotal</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>constrain</span>(<span style=color:#a6e22e>gtotal</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>255</span>);
</span></span><span style=display:flex><span> <span style=color:#a6e22e>btotal</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>constrain</span>(<span style=color:#a6e22e>btotal</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>255</span>);
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span> <span style=color:#75715e>// Return the resulting color
</span></span></span><span style=display:flex><span><span style=color:#75715e></span> <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>color</span>(<span style=color:#a6e22e>rtotal</span>, <span style=color:#a6e22e>gtotal</span>, <span style=color:#a6e22e>btotal</span>);
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>applySharpen</span>() {
</span></span><span style=display:flex><span> <span style=color:#a6e22e>convolve</span>(<span style=color:#e6db74>&#34;Sharpen&#34;</span>, <span style=color:#a6e22e>kernels</span>[<span style=color:#e6db74>&#34;Sharpen&#34;</span>]);
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>applyBoxBlur</span>() {
</span></span><span style=display:flex><span> <span style=color:#a6e22e>convolve</span>(<span style=color:#e6db74>&#34;BoxBlur&#34;</span>, <span style=color:#a6e22e>kernels</span>[<span style=color:#e6db74>&#34;BoxBlur&#34;</span>]);
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>applyGaussianBlur3x3</span>() {
</span></span><span style=display:flex><span> <span style=color:#a6e22e>convolve</span>(<span style=color:#e6db74>&#34;GaussianBlur3x3&#34;</span>, <span style=color:#a6e22e>kernels</span>[<span style=color:#e6db74>&#34;GaussianBlur3x3&#34;</span>]);
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>applyGaussianBlur5x5</span>() {
</span></span><span style=display:flex><span> <span style=color:#a6e22e>convolve</span>(<span style=color:#e6db74>&#34;GaussianBlur5x5&#34;</span>, <span style=color:#a6e22e>kernels</span>[<span style=color:#e6db74>&#34;GaussianBlur5x5&#34;</span>]);
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>applyUnsharp5x5</span>() {
</span></span><span style=display:flex><span> <span style=color:#a6e22e>convolve</span>(<span style=color:#e6db74>&#34;Unsharp5x5&#34;</span>, <span style=color:#a6e22e>kernels</span>[<span style=color:#e6db74>&#34;Unsharp5x5&#34;</span>]);
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>kernels</span> <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span> <span style=color:#e6db74>&#34;Sharpen&#34;</span> <span style=color:#f92672>:</span> [[<span style=color:#ae81ff>0</span>,<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>,<span style=color:#ae81ff>0</span>],
</span></span><span style=display:flex><span>              [<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>,<span style=color:#ae81ff>5</span>,<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>],
</span></span><span style=display:flex><span>              [<span style=color:#ae81ff>0</span>,<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>,<span style=color:#ae81ff>0</span>]],
</span></span><span style=display:flex><span> <span style=color:#e6db74>&#34;BoxBlur&#34;</span> <span style=color:#f92672>:</span> [[<span style=color:#ae81ff>1</span><span style=color:#f92672>/</span><span style=color:#ae81ff>9</span>,<span style=color:#ae81ff>1</span><span style=color:#f92672>/</span><span style=color:#ae81ff>9</span>,<span style=color:#ae81ff>1</span><span style=color:#f92672>/</span><span style=color:#ae81ff>9</span>],
</span></span><span style=display:flex><span>               [<span style=color:#ae81ff>1</span><span style=color:#f92672>/</span><span style=color:#ae81ff>9</span>,<span style=color:#ae81ff>1</span><span style=color:#f92672>/</span><span style=color:#ae81ff>9</span>,<span style=color:#ae81ff>1</span><span style=color:#f92672>/</span><span style=color:#ae81ff>9</span>],
</span></span><span style=display:flex><span>               [<span style=color:#ae81ff>1</span><span style=color:#f92672>/</span><span style=color:#ae81ff>9</span>,<span style=color:#ae81ff>1</span><span style=color:#f92672>/</span><span style=color:#ae81ff>9</span>,<span style=color:#ae81ff>1</span><span style=color:#f92672>/</span><span style=color:#ae81ff>9</span>]],
</span></span><span style=display:flex><span> <span style=color:#e6db74>&#34;GaussianBlur3x3&#34;</span> <span style=color:#f92672>:</span> [[<span style=color:#ae81ff>1</span><span style=color:#f92672>/</span><span style=color:#ae81ff>16</span>,<span style=color:#ae81ff>1</span><span style=color:#f92672>/</span><span style=color:#ae81ff>8</span>,<span style=color:#ae81ff>1</span><span style=color:#f92672>/</span><span style=color:#ae81ff>16</span>],
</span></span><span style=display:flex><span>                          [<span style=color:#ae81ff>1</span><span style=color:#f92672>/</span><span style=color:#ae81ff>8</span>,<span style=color:#ae81ff>1</span><span style=color:#f92672>/</span><span style=color:#ae81ff>4</span>,<span style=color:#ae81ff>1</span><span style=color:#f92672>/</span><span style=color:#ae81ff>8</span>],
</span></span><span style=display:flex><span>                          [<span style=color:#ae81ff>1</span><span style=color:#f92672>/</span><span style=color:#ae81ff>16</span>,<span style=color:#ae81ff>1</span><span style=color:#f92672>/</span><span style=color:#ae81ff>8</span>,<span style=color:#ae81ff>1</span><span style=color:#f92672>/</span><span style=color:#ae81ff>16</span>]],
</span></span><span style=display:flex><span> <span style=color:#e6db74>&#34;GaussianBlur5x5&#34;</span> <span style=color:#f92672>:</span> [[<span style=color:#ae81ff>1</span><span style=color:#f92672>/</span><span style=color:#ae81ff>256</span>,<span style=color:#ae81ff>4</span><span style=color:#f92672>/</span><span style=color:#ae81ff>256</span>,<span style=color:#ae81ff>6</span><span style=color:#f92672>/</span><span style=color:#ae81ff>256</span>,<span style=color:#ae81ff>4</span><span style=color:#f92672>/</span><span style=color:#ae81ff>256</span>,<span style=color:#ae81ff>1</span><span style=color:#f92672>/</span><span style=color:#ae81ff>256</span>],
</span></span><span style=display:flex><span>                          [<span style=color:#ae81ff>4</span><span style=color:#f92672>/</span><span style=color:#ae81ff>256</span>,<span style=color:#ae81ff>16</span><span style=color:#f92672>/</span><span style=color:#ae81ff>256</span>,<span style=color:#ae81ff>1</span><span style=color:#f92672>/</span><span style=color:#ae81ff>256</span>,<span style=color:#ae81ff>16</span><span style=color:#f92672>/</span><span style=color:#ae81ff>256</span>,<span style=color:#ae81ff>4</span><span style=color:#f92672>/</span><span style=color:#ae81ff>256</span>],
</span></span><span style=display:flex><span>                          [<span style=color:#ae81ff>6</span><span style=color:#f92672>/</span><span style=color:#ae81ff>256</span>,<span style=color:#ae81ff>24</span><span style=color:#f92672>/</span><span style=color:#ae81ff>256</span>,<span style=color:#ae81ff>36</span><span style=color:#f92672>/</span><span style=color:#ae81ff>256</span>,<span style=color:#ae81ff>24</span><span style=color:#f92672>/</span><span style=color:#ae81ff>256</span>,<span style=color:#ae81ff>6</span><span style=color:#f92672>/</span><span style=color:#ae81ff>256</span>],
</span></span><span style=display:flex><span>                          [<span style=color:#ae81ff>4</span><span style=color:#f92672>/</span><span style=color:#ae81ff>256</span>,<span style=color:#ae81ff>16</span><span style=color:#f92672>/</span><span style=color:#ae81ff>256</span>,<span style=color:#ae81ff>1</span><span style=color:#f92672>/</span><span style=color:#ae81ff>256</span>,<span style=color:#ae81ff>16</span><span style=color:#f92672>/</span><span style=color:#ae81ff>256</span>,<span style=color:#ae81ff>4</span><span style=color:#f92672>/</span><span style=color:#ae81ff>256</span>],
</span></span><span style=display:flex><span>                          [<span style=color:#ae81ff>1</span><span style=color:#f92672>/</span><span style=color:#ae81ff>256</span>,<span style=color:#ae81ff>4</span><span style=color:#f92672>/</span><span style=color:#ae81ff>256</span>,<span style=color:#ae81ff>6</span><span style=color:#f92672>/</span><span style=color:#ae81ff>256</span>,<span style=color:#ae81ff>4</span><span style=color:#f92672>/</span><span style=color:#ae81ff>256</span>,<span style=color:#ae81ff>1</span><span style=color:#f92672>/</span><span style=color:#ae81ff>256</span>]],
</span></span><span style=display:flex><span> <span style=color:#e6db74>&#34;Unsharp5x5&#34;</span> <span style=color:#f92672>:</span> [[<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span><span style=color:#f92672>/</span><span style=color:#ae81ff>256</span>,<span style=color:#f92672>-</span><span style=color:#ae81ff>4</span><span style=color:#f92672>/</span><span style=color:#ae81ff>256</span>,<span style=color:#f92672>-</span><span style=color:#ae81ff>6</span><span style=color:#f92672>/</span><span style=color:#ae81ff>256</span>,<span style=color:#f92672>-</span><span style=color:#ae81ff>4</span><span style=color:#f92672>/</span><span style=color:#ae81ff>256</span>,<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span><span style=color:#f92672>/</span><span style=color:#ae81ff>256</span>],
</span></span><span style=display:flex><span>                            [<span style=color:#f92672>-</span><span style=color:#ae81ff>4</span><span style=color:#f92672>/</span><span style=color:#ae81ff>256</span>,<span style=color:#f92672>-</span><span style=color:#ae81ff>16</span><span style=color:#f92672>/</span><span style=color:#ae81ff>256</span>,<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span><span style=color:#f92672>/</span><span style=color:#ae81ff>256</span>,<span style=color:#f92672>-</span><span style=color:#ae81ff>16</span><span style=color:#f92672>/</span><span style=color:#ae81ff>256</span>,<span style=color:#f92672>-</span><span style=color:#ae81ff>4</span><span style=color:#f92672>/</span><span style=color:#ae81ff>256</span>],
</span></span><span style=display:flex><span>                            [<span style=color:#f92672>-</span><span style=color:#ae81ff>6</span><span style=color:#f92672>/</span><span style=color:#ae81ff>256</span>,<span style=color:#f92672>-</span><span style=color:#ae81ff>24</span><span style=color:#f92672>/</span><span style=color:#ae81ff>256</span>,<span style=color:#ae81ff>476</span><span style=color:#f92672>/</span><span style=color:#ae81ff>256</span>,<span style=color:#f92672>-</span><span style=color:#ae81ff>24</span><span style=color:#f92672>/</span><span style=color:#ae81ff>256</span>,<span style=color:#f92672>-</span><span style=color:#ae81ff>6</span><span style=color:#f92672>/</span><span style=color:#ae81ff>256</span>],
</span></span><span style=display:flex><span>                            [<span style=color:#f92672>-</span><span style=color:#ae81ff>4</span><span style=color:#f92672>/</span><span style=color:#ae81ff>256</span>,<span style=color:#f92672>-</span><span style=color:#ae81ff>16</span><span style=color:#f92672>/</span><span style=color:#ae81ff>256</span>,<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span><span style=color:#f92672>/</span><span style=color:#ae81ff>256</span>,<span style=color:#f92672>-</span><span style=color:#ae81ff>16</span><span style=color:#f92672>/</span><span style=color:#ae81ff>256</span>,<span style=color:#f92672>-</span><span style=color:#ae81ff>4</span><span style=color:#f92672>/</span><span style=color:#ae81ff>256</span>],
</span></span><span style=display:flex><span>                            [<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span><span style=color:#f92672>/</span><span style=color:#ae81ff>256</span>,<span style=color:#f92672>-</span><span style=color:#ae81ff>4</span><span style=color:#f92672>/</span><span style=color:#ae81ff>256</span>,<span style=color:#f92672>-</span><span style=color:#ae81ff>6</span><span style=color:#f92672>/</span><span style=color:#ae81ff>256</span>,<span style=color:#f92672>-</span><span style=color:#ae81ff>4</span><span style=color:#f92672>/</span><span style=color:#ae81ff>256</span>,<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span><span style=color:#f92672>/</span><span style=color:#ae81ff>256</span>]],
</span></span><span style=display:flex><span>};
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>img</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>input</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>histogramTypeSelect</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>sharpenButton</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>boxBlurButton</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>gaussianBlur3x3Button</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>gaussianBlur5x5Button</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>unsharpMasking5x5Button</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>lumaButton</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>handleFiles</span>() {
</span></span><span style=display:flex><span> <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>fileList</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>files</span>; <span style=color:#75715e>/* now you can work with the file list */</span>
</span></span><span style=display:flex><span> <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>file</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>fileList</span>[<span style=color:#ae81ff>0</span>]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span> <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>reader</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>FileReader</span>();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span> <span style=color:#a6e22e>reader</span>.<span style=color:#a6e22e>onload</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>function</span>(<span style=color:#a6e22e>e</span>) {
</span></span><span style=display:flex><span>   <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>file</span>.<span style=color:#a6e22e>type</span> <span style=color:#f92672>===</span> <span style=color:#e6db74>&#39;image/png&#39;</span> <span style=color:#f92672>||</span> <span style=color:#a6e22e>file</span>.<span style=color:#a6e22e>type</span> <span style=color:#f92672>===</span> <span style=color:#e6db74>&#39;image/jpeg&#39;</span>) {
</span></span><span style=display:flex><span>     <span style=color:#a6e22e>img</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>loadImage</span>(<span style=color:#a6e22e>e</span>.<span style=color:#a6e22e>target</span>.<span style=color:#a6e22e>result</span>, <span style=color:#e6db74>&#39;&#39;</span>);
</span></span><span style=display:flex><span>     <span style=color:#a6e22e>img</span>.<span style=color:#a6e22e>loadPixels</span>();
</span></span><span style=display:flex><span>   } <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>     <span style=color:#a6e22e>img</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>null</span>;
</span></span><span style=display:flex><span>   }
</span></span><span style=display:flex><span> }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span> <span style=color:#a6e22e>reader</span>.<span style=color:#a6e22e>readAsDataURL</span>(<span style=color:#a6e22e>file</span>);
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>setup</span>() {
</span></span><span style=display:flex><span> <span style=color:#a6e22e>createCanvas</span>(<span style=color:#a6e22e>HW</span><span style=color:#f92672>+</span><span style=color:#ae81ff>100</span>, <span style=color:#a6e22e>HH</span><span style=color:#f92672>+</span><span style=color:#ae81ff>100</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>HP</span>);
</span></span><span style=display:flex><span> <span style=color:#a6e22e>input</span> <span style=color:#f92672>=</span> document.<span style=color:#a6e22e>getElementById</span>(<span style=color:#e6db74>&#34;file-input&#34;</span>);
</span></span><span style=display:flex><span> <span style=color:#a6e22e>input</span>.<span style=color:#a6e22e>addEventListener</span>(<span style=color:#e6db74>&#34;change&#34;</span>, <span style=color:#a6e22e>handleFiles</span>, <span style=color:#66d9ef>false</span>);
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span> <span style=color:#a6e22e>histogramTypeSelect</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>createSelect</span>();
</span></span><span style=display:flex><span> <span style=color:#a6e22e>histogramTypeSelect</span>.<span style=color:#a6e22e>position</span>(<span style=color:#a6e22e>HP</span><span style=color:#f92672>-</span><span style=color:#ae81ff>50</span>, <span style=color:#a6e22e>HP</span><span style=color:#f92672>-</span><span style=color:#ae81ff>50</span>);
</span></span><span style=display:flex><span> <span style=color:#a6e22e>histogramTypeSelect</span>.<span style=color:#a6e22e>option</span>(<span style=color:#e6db74>&#39;RGB&#39;</span>); 
</span></span><span style=display:flex><span> <span style=color:#a6e22e>histogramTypeSelect</span>.<span style=color:#a6e22e>option</span>(<span style=color:#e6db74>&#39;Brightness&#39;</span>);
</span></span><span style=display:flex><span> <span style=color:#a6e22e>histogramTypeSelect</span>.<span style=color:#a6e22e>hide</span>();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span> <span style=color:#a6e22e>sharpenButton</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>createButton</span>(<span style=color:#e6db74>&#39;Sharpen&#39;</span>);
</span></span><span style=display:flex><span> <span style=color:#a6e22e>sharpenButton</span>.<span style=color:#a6e22e>position</span>(<span style=color:#ae81ff>10</span>, <span style=color:#ae81ff>30</span>);
</span></span><span style=display:flex><span> <span style=color:#a6e22e>sharpenButton</span>.<span style=color:#a6e22e>mousePressed</span>(<span style=color:#a6e22e>applySharpen</span>);
</span></span><span style=display:flex><span> <span style=color:#a6e22e>sharpenButton</span>.<span style=color:#a6e22e>hide</span>();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span> <span style=color:#a6e22e>boxBlurButton</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>createButton</span>(<span style=color:#e6db74>&#39;Box blur&#39;</span>);
</span></span><span style=display:flex><span> <span style=color:#a6e22e>boxBlurButton</span>.<span style=color:#a6e22e>position</span>(<span style=color:#ae81ff>10</span>, <span style=color:#ae81ff>70</span>);
</span></span><span style=display:flex><span> <span style=color:#a6e22e>boxBlurButton</span>.<span style=color:#a6e22e>mousePressed</span>(<span style=color:#a6e22e>applyBoxBlur</span>);
</span></span><span style=display:flex><span> <span style=color:#a6e22e>boxBlurButton</span>.<span style=color:#a6e22e>hide</span>();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span> <span style=color:#a6e22e>gaussianBlur3x3Button</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>createButton</span>(<span style=color:#e6db74>&#39;Gaussian blur(3x3)&#39;</span>);
</span></span><span style=display:flex><span> <span style=color:#a6e22e>gaussianBlur3x3Button</span>.<span style=color:#a6e22e>position</span>(<span style=color:#ae81ff>10</span>, <span style=color:#ae81ff>110</span>);
</span></span><span style=display:flex><span> <span style=color:#a6e22e>gaussianBlur3x3Button</span>.<span style=color:#a6e22e>mousePressed</span>(<span style=color:#a6e22e>applyGaussianBlur3x3</span>);
</span></span><span style=display:flex><span> <span style=color:#a6e22e>gaussianBlur3x3Button</span>.<span style=color:#a6e22e>hide</span>();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span> <span style=color:#a6e22e>gaussianBlur5x5Button</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>createButton</span>(<span style=color:#e6db74>&#39;Gaussian blur(5x5)&#39;</span>);
</span></span><span style=display:flex><span> <span style=color:#a6e22e>gaussianBlur5x5Button</span>.<span style=color:#a6e22e>position</span>(<span style=color:#ae81ff>200</span>, <span style=color:#ae81ff>30</span>);
</span></span><span style=display:flex><span> <span style=color:#a6e22e>gaussianBlur5x5Button</span>.<span style=color:#a6e22e>mousePressed</span>(<span style=color:#a6e22e>applyGaussianBlur5x5</span>);
</span></span><span style=display:flex><span> <span style=color:#a6e22e>gaussianBlur5x5Button</span>.<span style=color:#a6e22e>hide</span>();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span> <span style=color:#a6e22e>unsharpMasking5x5Button</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>createButton</span>(<span style=color:#e6db74>&#39;Unsharp&#39;</span>);
</span></span><span style=display:flex><span> <span style=color:#a6e22e>unsharpMasking5x5Button</span>.<span style=color:#a6e22e>position</span>(<span style=color:#ae81ff>200</span>, <span style=color:#ae81ff>70</span>);
</span></span><span style=display:flex><span> <span style=color:#a6e22e>unsharpMasking5x5Button</span>.<span style=color:#a6e22e>mousePressed</span>(<span style=color:#a6e22e>applyUnsharp5x5</span>);
</span></span><span style=display:flex><span> <span style=color:#a6e22e>unsharpMasking5x5Button</span>.<span style=color:#a6e22e>hide</span>();
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span> <span style=color:#a6e22e>lumaButton</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>createButton</span>(<span style=color:#e6db74>&#39;Luminance&#39;</span>);
</span></span><span style=display:flex><span> <span style=color:#a6e22e>lumaButton</span>.<span style=color:#a6e22e>position</span>(<span style=color:#ae81ff>200</span>, <span style=color:#ae81ff>110</span>);
</span></span><span style=display:flex><span> <span style=color:#a6e22e>lumaButton</span>.<span style=color:#a6e22e>mousePressed</span>(<span style=color:#a6e22e>applyLuma</span>);
</span></span><span style=display:flex><span> <span style=color:#a6e22e>lumaButton</span>.<span style=color:#a6e22e>hide</span>();
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>draw</span>() {
</span></span><span style=display:flex><span> <span style=color:#a6e22e>background</span>(<span style=color:#ae81ff>0</span>);
</span></span><span style=display:flex><span> <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>img</span>) {
</span></span><span style=display:flex><span>   <span style=color:#a6e22e>histogramTypeSelect</span>.<span style=color:#a6e22e>show</span>();
</span></span><span style=display:flex><span>   <span style=color:#a6e22e>sharpenButton</span>.<span style=color:#a6e22e>show</span>();
</span></span><span style=display:flex><span>   <span style=color:#a6e22e>boxBlurButton</span>.<span style=color:#a6e22e>show</span>();
</span></span><span style=display:flex><span>   <span style=color:#a6e22e>gaussianBlur3x3Button</span>.<span style=color:#a6e22e>show</span>();
</span></span><span style=display:flex><span>   <span style=color:#a6e22e>gaussianBlur5x5Button</span>.<span style=color:#a6e22e>show</span>();
</span></span><span style=display:flex><span>   <span style=color:#a6e22e>unsharpMasking5x5Button</span>.<span style=color:#a6e22e>show</span>();
</span></span><span style=display:flex><span>   <span style=color:#a6e22e>lumaButton</span>.<span style=color:#a6e22e>show</span>();
</span></span><span style=display:flex><span>   <span style=color:#a6e22e>img</span>.<span style=color:#a6e22e>loadPixels</span>();
</span></span><span style=display:flex><span>   <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>histogramTypeSelect</span>.<span style=color:#a6e22e>value</span>() <span style=color:#f92672>===</span> <span style=color:#e6db74>&#39;RGB&#39;</span>) {
</span></span><span style=display:flex><span>     <span style=color:#a6e22e>drawRGBHistogram</span>(<span style=color:#a6e22e>img</span>.<span style=color:#a6e22e>pixels</span>);
</span></span><span style=display:flex><span>   } <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>     <span style=color:#a6e22e>drawBrightnessHistogram</span>(<span style=color:#a6e22e>img</span>.<span style=color:#a6e22e>pixels</span>)
</span></span><span style=display:flex><span>   }
</span></span><span style=display:flex><span> }
</span></span><span style=display:flex><span>}</span></span></code></pre></div></div></details><p>To get the script working properly, we need to add an html input element that is going to be used by the script.</p><details><summary>input-element.html</summary><div class=markdown-inner><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#f92672>&lt;</span><span style=color:#a6e22e>div</span> <span style=color:#66d9ef>class</span><span style=color:#f92672>=</span><span style=color:#a6e22e>controls</span><span style=color:#f92672>&gt;&lt;</span><span style=color:#a6e22e>input</span> <span style=color:#a6e22e>id</span><span style=color:#f92672>=</span><span style=color:#a6e22e>file</span><span style=color:#f92672>-</span><span style=color:#a6e22e>input</span> <span style=color:#a6e22e>type</span><span style=color:#f92672>=</span><span style=color:#a6e22e>file</span><span style=color:#f92672>&gt;&lt;</span><span style=color:#960050;background-color:#1e0010>/div&gt;</span></span></span></code></pre></div></div></details><p>To show how the script works, in the next sketch a random image is loaded and after the process is applied, the result is shown replacing the actual image.</p><p>You can select three different modes:</p><ul><li>RGB histogram: display the rgb histogram for the actual image.</li><li>Brightness histogram: display the brightness histogram for the actual image.</li><li>Image: display the actual image according to the process or original if you click that button.</li></ul><p>Finally you can refresh the image that is being used.</p><iframe id=web_app style=width:610px;height:750px srcdoc="
        <!DOCTYPE html>
        <html>
          <head>
            <script src=https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.5.0/p5.min.js></script>
            <script src=https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.5.0/addons/p5.sound.min.js></script>
            
            
            
            
            
            <script src=/showcase/sketches/exercises/masking/web_app.js></script>
          </head>
          <body>
          </body>
        </html>
      "></iframe><p>But if you want to use the original script, here is an sketch that uses it, you can download your modified images feel free to extend the script and provide it to the community.</p><iframe id=original_web_app style=width:610px;height:750px srcdoc="
        <!DOCTYPE html>
        <html>
          <head>
            <script src=https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.5.0/p5.min.js></script>
            <script src=https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.5.0/addons/p5.sound.min.js></script>
            
            
            
            
            
            <script src=/showcase/sketches/exercises/masking/original_web_app.js></script>
          </head>
          <body>
            <div class=controls><input id=file-input type=file></div>
          </body>
        </html>
      "></iframe></article><footer class=book-footer><div class="flex flex-wrap justify-between"><div><a class="flex align-center" href=https://github.com/visualcomputing/showcase/commit/e311bf6ca85a7a419c24cfc0221d91cd16eb51a4 title='Last modified by adol2299 | April 27, 2023' target=_blank rel=noopener><img src=/showcase/svg/calendar.svg class=book-icon alt=Calendar>
<span>April 27, 2023</span></a></div></div><script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){if(window.getSelection().toString())return;e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script></footer><div class=book-comments></div><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><nav id=TableOfContents><ul><li><a href=#masking>Masking</a><ul><li><a href=#kinegram>Kinegram</a><ul><li><a href=#implementation>Implementation</a></li></ul></li><li><a href=#moire-pattern>Moire Pattern</a><ul><li><a href=#implementation-1>Implementation</a></li></ul></li></ul></li><li><a href=#floyd-steinberg-dithering>Floyd-Steinberg dithering</a><ul><li><a href=#quantizing>Quantizing</a></li><li><a href=#quantizing-error>Quantizing error</a></li><li><a href=#floyd-steinberg-algorithm>Floyd-Steinberg algorithm</a></li></ul></li><li><a href=#floyd-steinberg-dithering-1>Floyd-Steinberg dithering</a><ul><li><a href=#quantizing-1>Quantizing</a></li><li><a href=#quantizing-error-1>Quantizing error</a></li><li><a href=#floyd-steinberg-algorithm-1>Floyd-Steinberg algorithm</a></li><li><a href=#web-app>Web app</a></li></ul></li></ul></nav></div></aside></main></body></html>