<!doctype html><html lang=en-us dir=ltr><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Masking # In the following image there are parallel lines in each row, but exists an illusion of a vertically displacement created by the irregular columns sort. The cafe wall illusion has been utilized by neuropsychologists to investigate how the brain processes visual information. Additionally, the illusion has found practical applications in graphic design and art.
Web app # On this exercise we provide a script to process images that can be embeded on any web application."><meta name=theme-color content="#FFFFFF"><meta name=color-scheme content="light dark"><meta property="og:title" content><meta property="og:description" content="Masking # In the following image there are parallel lines in each row, but exists an illusion of a vertically displacement created by the irregular columns sort. The cafe wall illusion has been utilized by neuropsychologists to investigate how the brain processes visual information. Additionally, the illusion has found practical applications in graphic design and art.
Web app # On this exercise we provide a script to process images that can be embeded on any web application."><meta property="og:type" content="article"><meta property="og:url" content="https://andryut.github.io/showcase/docs/exercises/Masking/"><meta property="article:section" content="docs"><meta property="article:modified_time" content="2023-03-28T01:46:07-05:00"><title>Masking | Showcase Template</title><link rel=manifest href=/showcase/manifest.json><link rel=icon href=/showcase/favicon.png type=image/x-icon><link rel=stylesheet href=/showcase/book.min.4b35fed0bea034bbc19c89c71e14b73fb9c68cfcc586b9382adfb9b7b103ba06.css integrity="sha256-SzX+0L6gNLvBnInHHhS3P7nGjPzFhrk4Kt+5t7EDugY=" crossorigin=anonymous><script defer src=/showcase/flexsearch.min.js></script>
<script defer src=/showcase/en.search.min.3a8d658c77eb93c7f12a2b8af49a700131e474f288eefb605d9fa61576dbe5a7.js integrity="sha256-Oo1ljHfrk8fxKiuK9JpwATHkdPKI7vtgXZ+mFXbb5ac=" crossorigin=anonymous></script></head><body dir=ltr><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a class="flex align-center" href=/showcase/><span>Showcase Template</span></a></h2><div class=book-search><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><ul><li class=book-section-flat><a href=/showcase/docs/team/>Team</a><ul></ul></li><li class=book-section-flat><a href=/showcase/docs/exercises/>Exercises</a><ul><li><a href=/showcase/docs/exercises/Coloring/>Coloring</a></li><li><a href=/showcase/docs/exercises/Depth-Perception/>Depth Perception</a></li><li><a href=/showcase/docs/exercises/Dithering/>Dithering</a></li><li><a href=/showcase/docs/exercises/Mach-Bands/>Mach Bands</a></li><li><a href=/showcase/docs/exercises/Masking/ class=active>Masking</a></li><li><a href=/showcase/docs/exercises/Spatial-Coherence/>Spatial Coherence</a></li><li><a href=/showcase/docs/exercises/Visual-Illusions/>Visual Illusions</a></li></ul></li><li><input type=checkbox id=section-9370f1a5d0248572ac505e0c6d4ad190 class=toggle>
<label for=section-9370f1a5d0248572ac505e0c6d4ad190 class="flex justify-between"><a href=/showcase/docs/shortcodes/>Shortcodes</a></label><ul><li><a href=/showcase/docs/shortcodes/buttons/>Buttons</a></li><li><a href=/showcase/docs/shortcodes/columns/>Columns</a></li><li><a href=/showcase/docs/shortcodes/details/>Details</a></li><li><a href=/showcase/docs/shortcodes/hints/>Hints</a></li><li><a href=/showcase/docs/shortcodes/katex/>Katex</a></li><li><a href=/showcase/docs/shortcodes/mermaid/>Mermaid</a></li><li><input type=checkbox id=section-ec67a64aba70b9df3d2a9acd6c92e3bc class=toggle>
<label for=section-ec67a64aba70b9df3d2a9acd6c92e3bc class="flex justify-between"><a href=/showcase/docs/shortcodes/p5/>P5</a></label><ul><li><a href=/showcase/docs/shortcodes/p5/iframe/>Iframe</a></li><li><a href=/showcase/docs/shortcodes/p5/div/>Div</a></li></ul></li><li><a href=/showcase/docs/shortcodes/tabs/>Tabs</a></li></ul></li></ul><ul><li><a href=/showcase/posts/>Blog</a></li></ul></nav><script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/showcase/svg/menu.svg class=book-icon alt=Menu></label>
<strong>Masking</strong>
<label for=toc-control><img src=/showcase/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><a href=#masking>Masking</a><ul><li><a href=#web-app>Web app</a></li></ul></li></ul></nav></aside></header><article class=markdown><h1 id=masking>Masking
<a class=anchor href=#masking>#</a></h1><p>In the following image there are parallel lines in each row, but exists an illusion of a vertically displacement created by the
irregular columns sort. The cafe wall illusion has been utilized by neuropsychologists to investigate how the brain processes visual information. Additionally, the illusion has found practical applications in graphic design and art.</p><p><iframe id=kinegram style=width:730px;height:460px srcdoc="
        <!DOCTYPE html>
        <html>
          <head>
            <script src=https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.5.0/p5.min.js></script>
            <script src=https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.5.0/addons/p5.sound.min.js></script>
            
            
            
            
            
            <script src=/showcase/sketches/exercises/visual_illusions/kinegram.js></script>
          </head>
          <body>
          </body>
        </html>
      "></iframe>
<iframe id=moire_pattern1 style=width:430px;height:450px srcdoc="
        <!DOCTYPE html>
        <html>
          <head>
            <script src=https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.5.0/p5.min.js></script>
            <script src=https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.5.0/addons/p5.sound.min.js></script>
            
            
            
            
            
            <script src=/showcase/sketches/exercises/visual_illusions/moire_pattern1.js></script>
          </head>
          <body>
          </body>
        </html>
      "></iframe>
<iframe id=moire_pattern2 style=width:430px;height:450px srcdoc="
        <!DOCTYPE html>
        <html>
          <head>
            <script src=https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.5.0/p5.min.js></script>
            <script src=https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.5.0/addons/p5.sound.min.js></script>
            
            
            
            
            
            <script src=/showcase/sketches/exercises/visual_illusions/moire_pattern2.js></script>
          </head>
          <body>
          </body>
        </html>
      "></iframe></p><h2 id=web-app>Web app
<a class=anchor href=#web-app>#</a></h2><p>On this exercise we provide a script to process images that can be embeded on any web application. But for practical purposes we show an example with predefined images.</p><p>The next p5 script allow us to load an image from our computer, then generates the histogram for the image and finally one can choose from various processes that can be applied to that image, when a process is applied the resulting image is automatically downloaded.</p><details><summary>web-app.js</summary><div class=markdown-inner><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>HW</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>400</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>HH</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>400</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>HP</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>200</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>BG</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>8</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>drawRGBHistogram</span>(<span style=color:#a6e22e>imgBuffer</span>) {
</span></span><span style=display:flex><span> <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>histR</span> <span style=color:#f92672>=</span> (<span style=color:#66d9ef>new</span> Array(<span style=color:#ae81ff>256</span>)).<span style=color:#a6e22e>fill</span>(<span style=color:#ae81ff>0</span>);
</span></span><span style=display:flex><span> <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>histG</span> <span style=color:#f92672>=</span> (<span style=color:#66d9ef>new</span> Array(<span style=color:#ae81ff>256</span>)).<span style=color:#a6e22e>fill</span>(<span style=color:#ae81ff>0</span>);
</span></span><span style=display:flex><span> <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>histB</span> <span style=color:#f92672>=</span> (<span style=color:#66d9ef>new</span> Array(<span style=color:#ae81ff>256</span>)).<span style=color:#a6e22e>fill</span>(<span style=color:#ae81ff>0</span>);
</span></span><span style=display:flex><span> <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>maxB</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span> <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>let</span> <span style=color:#a6e22e>i</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>; <span style=color:#a6e22e>i</span> <span style=color:#f92672>&lt;</span> <span style=color:#a6e22e>imgBuffer</span>.<span style=color:#a6e22e>length</span>; <span style=color:#a6e22e>i</span> <span style=color:#f92672>+=</span> <span style=color:#ae81ff>4</span>) {
</span></span><span style=display:flex><span>   <span style=color:#a6e22e>histR</span>[<span style=color:#a6e22e>imgBuffer</span>[<span style=color:#a6e22e>i</span>]]<span style=color:#f92672>++</span>;
</span></span><span style=display:flex><span>   <span style=color:#a6e22e>histG</span>[<span style=color:#a6e22e>imgBuffer</span>[<span style=color:#a6e22e>i</span> <span style=color:#f92672>+</span> <span style=color:#ae81ff>1</span>]]<span style=color:#f92672>++</span>;
</span></span><span style=display:flex><span>   <span style=color:#a6e22e>histB</span>[<span style=color:#a6e22e>imgBuffer</span>[<span style=color:#a6e22e>i</span> <span style=color:#f92672>+</span> <span style=color:#ae81ff>2</span>]]<span style=color:#f92672>++</span>;
</span></span><span style=display:flex><span> }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span> <span style=color:#a6e22e>maxB</span> <span style=color:#f92672>=</span> Math.<span style=color:#a6e22e>max</span>(Math.<span style=color:#a6e22e>max</span>(...<span style=color:#a6e22e>histR</span>), Math.<span style=color:#a6e22e>max</span>(...<span style=color:#a6e22e>histG</span>), Math.<span style=color:#a6e22e>max</span>(...<span style=color:#a6e22e>histB</span>));
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span> <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>y1</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>HP</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>HH</span>;
</span></span><span style=display:flex><span> <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>dx</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>HW</span> <span style=color:#f92672>/</span> <span style=color:#ae81ff>255</span>;
</span></span><span style=display:flex><span> <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>dy</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>HW</span> <span style=color:#f92672>/</span> <span style=color:#a6e22e>maxB</span>;
</span></span><span style=display:flex><span> <span style=color:#a6e22e>rect</span>(<span style=color:#ae81ff>0</span>, <span style=color:#a6e22e>HP</span>, <span style=color:#a6e22e>HW</span>, <span style=color:#a6e22e>HH</span>);
</span></span><span style=display:flex><span> <span style=color:#a6e22e>strokeWeight</span>(<span style=color:#a6e22e>dx</span>);
</span></span><span style=display:flex><span>   
</span></span><span style=display:flex><span> <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>let</span> <span style=color:#a6e22e>i</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>; <span style=color:#a6e22e>i</span> <span style=color:#f92672>&lt;</span> <span style=color:#ae81ff>256</span>; <span style=color:#a6e22e>i</span><span style=color:#f92672>++</span>) {
</span></span><span style=display:flex><span>   <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>x</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>i</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>dx</span>;
</span></span><span style=display:flex><span>   <span style=color:#a6e22e>stroke</span>(<span style=color:#a6e22e>color</span>(<span style=color:#ae81ff>220</span>,<span style=color:#ae81ff>0</span>,<span style=color:#ae81ff>0</span>,<span style=color:#ae81ff>128</span>));
</span></span><span style=display:flex><span>   <span style=color:#a6e22e>line</span>(<span style=color:#a6e22e>x</span>, <span style=color:#a6e22e>y1</span>, <span style=color:#a6e22e>x</span>, <span style=color:#a6e22e>y1</span> <span style=color:#f92672>-</span> <span style=color:#a6e22e>histR</span>[<span style=color:#a6e22e>i</span>] <span style=color:#f92672>*</span> <span style=color:#a6e22e>dy</span>);
</span></span><span style=display:flex><span>   <span style=color:#a6e22e>stroke</span>(<span style=color:#a6e22e>color</span>(<span style=color:#ae81ff>0</span>,<span style=color:#ae81ff>210</span>,<span style=color:#ae81ff>0</span>,<span style=color:#ae81ff>128</span>));
</span></span><span style=display:flex><span>   <span style=color:#a6e22e>line</span>(<span style=color:#a6e22e>x</span>, <span style=color:#a6e22e>y1</span>, <span style=color:#a6e22e>x</span>, <span style=color:#a6e22e>y1</span> <span style=color:#f92672>-</span> <span style=color:#a6e22e>histG</span>[<span style=color:#a6e22e>i</span>] <span style=color:#f92672>*</span> <span style=color:#a6e22e>dy</span>);
</span></span><span style=display:flex><span>   <span style=color:#a6e22e>stroke</span>(<span style=color:#a6e22e>color</span>(<span style=color:#ae81ff>0</span>,<span style=color:#ae81ff>0</span>,<span style=color:#ae81ff>255</span>,<span style=color:#ae81ff>128</span>));
</span></span><span style=display:flex><span>   <span style=color:#a6e22e>line</span>(<span style=color:#a6e22e>x</span>, <span style=color:#a6e22e>y1</span>, <span style=color:#a6e22e>x</span>, <span style=color:#a6e22e>y1</span> <span style=color:#f92672>-</span> <span style=color:#a6e22e>histB</span>[<span style=color:#a6e22e>i</span>] <span style=color:#f92672>*</span> <span style=color:#a6e22e>dy</span>);
</span></span><span style=display:flex><span>   <span style=color:#a6e22e>stroke</span>(<span style=color:#a6e22e>color</span>(<span style=color:#a6e22e>i</span>, <span style=color:#a6e22e>i</span>, <span style=color:#a6e22e>i</span>));
</span></span><span style=display:flex><span>   <span style=color:#a6e22e>line</span>(<span style=color:#a6e22e>x</span>, <span style=color:#a6e22e>y1</span>, <span style=color:#a6e22e>x</span>, <span style=color:#a6e22e>y1</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>BG</span>);
</span></span><span style=display:flex><span> }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>drawBrightnessHistogram</span>(<span style=color:#a6e22e>imgBuffer</span>) {
</span></span><span style=display:flex><span> <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>hist</span> <span style=color:#f92672>=</span> (<span style=color:#66d9ef>new</span> Array(<span style=color:#ae81ff>256</span>)).<span style=color:#a6e22e>fill</span>(<span style=color:#ae81ff>0</span>);
</span></span><span style=display:flex><span> <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>maxB</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span> <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>let</span> <span style=color:#a6e22e>i</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>; <span style=color:#a6e22e>i</span> <span style=color:#f92672>&lt;</span> <span style=color:#a6e22e>imgBuffer</span>.<span style=color:#a6e22e>length</span>; <span style=color:#a6e22e>i</span><span style=color:#f92672>++</span>) {
</span></span><span style=display:flex><span>   <span style=color:#75715e>// Ignoring alpha
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>   <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>i</span><span style=color:#f92672>%</span><span style=color:#ae81ff>4</span> <span style=color:#f92672>!=</span> <span style=color:#ae81ff>3</span>) {
</span></span><span style=display:flex><span>     <span style=color:#a6e22e>hist</span>[<span style=color:#a6e22e>imgBuffer</span>[<span style=color:#a6e22e>i</span>]]<span style=color:#f92672>++</span>;
</span></span><span style=display:flex><span>   }
</span></span><span style=display:flex><span> }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span> <span style=color:#a6e22e>maxB</span> <span style=color:#f92672>=</span> Math.<span style=color:#a6e22e>max</span>(...<span style=color:#a6e22e>hist</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span> <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>y1</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>HP</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>HH</span>;
</span></span><span style=display:flex><span> <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>dx</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>HW</span> <span style=color:#f92672>/</span> <span style=color:#ae81ff>255</span>;
</span></span><span style=display:flex><span> <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>dy</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>HW</span> <span style=color:#f92672>/</span> <span style=color:#a6e22e>maxB</span>;
</span></span><span style=display:flex><span> <span style=color:#a6e22e>rect</span>(<span style=color:#ae81ff>0</span>, <span style=color:#a6e22e>HP</span>, <span style=color:#a6e22e>HW</span>, <span style=color:#a6e22e>HH</span>);
</span></span><span style=display:flex><span> <span style=color:#a6e22e>strokeWeight</span>(<span style=color:#a6e22e>dx</span>);
</span></span><span style=display:flex><span>   
</span></span><span style=display:flex><span> <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>let</span> <span style=color:#a6e22e>i</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>; <span style=color:#a6e22e>i</span> <span style=color:#f92672>&lt;</span> <span style=color:#ae81ff>256</span>; <span style=color:#a6e22e>i</span><span style=color:#f92672>++</span>) {
</span></span><span style=display:flex><span>   <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>x</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>i</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>dx</span>;
</span></span><span style=display:flex><span>   <span style=color:#a6e22e>stroke</span>(<span style=color:#a6e22e>color</span>(<span style=color:#e6db74>&#34;black&#34;</span>));
</span></span><span style=display:flex><span>   <span style=color:#a6e22e>line</span>(<span style=color:#a6e22e>x</span>, <span style=color:#a6e22e>y1</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>BG</span>, <span style=color:#a6e22e>x</span>, <span style=color:#a6e22e>y1</span> <span style=color:#f92672>-</span> <span style=color:#a6e22e>hist</span>[<span style=color:#a6e22e>i</span>] <span style=color:#f92672>*</span> <span style=color:#a6e22e>dy</span>);
</span></span><span style=display:flex><span>   <span style=color:#a6e22e>stroke</span>(<span style=color:#a6e22e>color</span>(<span style=color:#a6e22e>i</span>, <span style=color:#a6e22e>i</span>, <span style=color:#a6e22e>i</span>));
</span></span><span style=display:flex><span>   <span style=color:#a6e22e>line</span>(<span style=color:#a6e22e>x</span>, <span style=color:#a6e22e>y1</span>, <span style=color:#a6e22e>x</span>, <span style=color:#a6e22e>y1</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>BG</span>);
</span></span><span style=display:flex><span> }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>copyArray</span>(<span style=color:#a6e22e>a</span>) {
</span></span><span style=display:flex><span> <span style=color:#a6e22e>c</span> <span style=color:#f92672>=</span> Array(<span style=color:#a6e22e>a</span>.<span style=color:#a6e22e>length</span>); 
</span></span><span style=display:flex><span> <span style=color:#a6e22e>i</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>a</span>.<span style=color:#a6e22e>length</span>;
</span></span><span style=display:flex><span> <span style=color:#66d9ef>while</span>(<span style=color:#a6e22e>i</span><span style=color:#f92672>--</span>) <span style=color:#a6e22e>c</span>[<span style=color:#a6e22e>i</span>] <span style=color:#f92672>=</span> <span style=color:#a6e22e>a</span>[<span style=color:#a6e22e>i</span>];
</span></span><span style=display:flex><span> <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>a</span>;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>applyLuma</span>(){
</span></span><span style=display:flex><span> <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>lumaImg</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>createImage</span>(<span style=color:#a6e22e>img</span>.<span style=color:#a6e22e>width</span>, <span style=color:#a6e22e>img</span>.<span style=color:#a6e22e>height</span>);
</span></span><span style=display:flex><span> <span style=color:#a6e22e>lumaImg</span>.<span style=color:#a6e22e>loadPixels</span>();
</span></span><span style=display:flex><span> <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>let</span> <span style=color:#a6e22e>i</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>; <span style=color:#a6e22e>i</span> <span style=color:#f92672>&lt;</span> <span style=color:#a6e22e>img</span>.<span style=color:#a6e22e>pixels</span>.<span style=color:#a6e22e>length</span>; <span style=color:#a6e22e>i</span><span style=color:#f92672>+=</span><span style=color:#ae81ff>4</span>) {
</span></span><span style=display:flex><span>   <span style=color:#a6e22e>lumaImg</span>.<span style=color:#a6e22e>pixels</span>[<span style=color:#a6e22e>i</span>] <span style=color:#f92672>=</span> (<span style=color:#a6e22e>img</span>.<span style=color:#a6e22e>pixels</span>[<span style=color:#a6e22e>i</span>] <span style=color:#f92672>+</span> <span style=color:#a6e22e>img</span>.<span style=color:#a6e22e>pixels</span>[<span style=color:#a6e22e>i</span> <span style=color:#f92672>+</span> <span style=color:#ae81ff>1</span>] <span style=color:#f92672>+</span> <span style=color:#a6e22e>img</span>.<span style=color:#a6e22e>pixels</span>[<span style=color:#a6e22e>i</span> <span style=color:#f92672>+</span> <span style=color:#ae81ff>2</span>]) <span style=color:#f92672>/</span> <span style=color:#ae81ff>3</span>;
</span></span><span style=display:flex><span>   <span style=color:#a6e22e>lumaImg</span>.<span style=color:#a6e22e>pixels</span>[<span style=color:#a6e22e>i</span> <span style=color:#f92672>+</span> <span style=color:#ae81ff>1</span>] <span style=color:#f92672>=</span> (<span style=color:#a6e22e>img</span>.<span style=color:#a6e22e>pixels</span>[<span style=color:#a6e22e>i</span>] <span style=color:#f92672>+</span> <span style=color:#a6e22e>img</span>.<span style=color:#a6e22e>pixels</span>[<span style=color:#a6e22e>i</span> <span style=color:#f92672>+</span> <span style=color:#ae81ff>1</span>] <span style=color:#f92672>+</span> <span style=color:#a6e22e>img</span>.<span style=color:#a6e22e>pixels</span>[<span style=color:#a6e22e>i</span> <span style=color:#f92672>+</span> <span style=color:#ae81ff>2</span>]) <span style=color:#f92672>/</span> <span style=color:#ae81ff>3</span>;
</span></span><span style=display:flex><span>   <span style=color:#a6e22e>lumaImg</span>.<span style=color:#a6e22e>pixels</span>[<span style=color:#a6e22e>i</span> <span style=color:#f92672>+</span> <span style=color:#ae81ff>2</span>] <span style=color:#f92672>=</span> (<span style=color:#a6e22e>img</span>.<span style=color:#a6e22e>pixels</span>[<span style=color:#a6e22e>i</span>] <span style=color:#f92672>+</span> <span style=color:#a6e22e>img</span>.<span style=color:#a6e22e>pixels</span>[<span style=color:#a6e22e>i</span> <span style=color:#f92672>+</span> <span style=color:#ae81ff>1</span>] <span style=color:#f92672>+</span> <span style=color:#a6e22e>img</span>.<span style=color:#a6e22e>pixels</span>[<span style=color:#a6e22e>i</span> <span style=color:#f92672>+</span> <span style=color:#ae81ff>2</span>]) <span style=color:#f92672>/</span> <span style=color:#ae81ff>3</span>;
</span></span><span style=display:flex><span>   <span style=color:#a6e22e>lumaImg</span>.<span style=color:#a6e22e>pixels</span>[<span style=color:#a6e22e>i</span> <span style=color:#f92672>+</span> <span style=color:#ae81ff>3</span>] <span style=color:#f92672>=</span> <span style=color:#ae81ff>255</span>;
</span></span><span style=display:flex><span> }
</span></span><span style=display:flex><span> <span style=color:#a6e22e>lumaImg</span>.<span style=color:#a6e22e>updatePixels</span>();
</span></span><span style=display:flex><span> <span style=color:#a6e22e>lumaImg</span>.<span style=color:#a6e22e>save</span>(<span style=color:#e6db74>&#39;luma&#39;</span>, <span style=color:#e6db74>&#39;png&#39;</span>);
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>convolve</span>(<span style=color:#a6e22e>name</span>, <span style=color:#a6e22e>matrix</span>) {
</span></span><span style=display:flex><span> <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>convolvedImage</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>createImage</span>(<span style=color:#a6e22e>img</span>.<span style=color:#a6e22e>width</span>, <span style=color:#a6e22e>img</span>.<span style=color:#a6e22e>height</span>);
</span></span><span style=display:flex><span> <span style=color:#a6e22e>convolvedImage</span>.<span style=color:#a6e22e>loadPixels</span>();
</span></span><span style=display:flex><span> <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>let</span> <span style=color:#a6e22e>x</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>; <span style=color:#a6e22e>x</span> <span style=color:#f92672>&lt;</span> <span style=color:#a6e22e>img</span>.<span style=color:#a6e22e>width</span>; <span style=color:#a6e22e>x</span><span style=color:#f92672>++</span>) {
</span></span><span style=display:flex><span>   <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>let</span> <span style=color:#a6e22e>y</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>; <span style=color:#a6e22e>y</span> <span style=color:#f92672>&lt;</span> <span style=color:#a6e22e>img</span>.<span style=color:#a6e22e>height</span>; <span style=color:#a6e22e>y</span><span style=color:#f92672>++</span>) {
</span></span><span style=display:flex><span>     <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>c</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>convolution</span>(<span style=color:#a6e22e>x</span>, <span style=color:#a6e22e>y</span>, <span style=color:#a6e22e>matrix</span>, <span style=color:#a6e22e>img</span>);
</span></span><span style=display:flex><span>     
</span></span><span style=display:flex><span>     <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>loc</span> <span style=color:#f92672>=</span> (<span style=color:#a6e22e>x</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>y</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>img</span>.<span style=color:#a6e22e>width</span>) <span style=color:#f92672>*</span> <span style=color:#ae81ff>4</span>;
</span></span><span style=display:flex><span>     <span style=color:#a6e22e>convolvedImage</span>.<span style=color:#a6e22e>pixels</span>[<span style=color:#a6e22e>loc</span>] <span style=color:#f92672>=</span> <span style=color:#a6e22e>red</span>(<span style=color:#a6e22e>c</span>);
</span></span><span style=display:flex><span>     <span style=color:#a6e22e>convolvedImage</span>.<span style=color:#a6e22e>pixels</span>[<span style=color:#a6e22e>loc</span> <span style=color:#f92672>+</span> <span style=color:#ae81ff>1</span>] <span style=color:#f92672>=</span> <span style=color:#a6e22e>green</span>(<span style=color:#a6e22e>c</span>);
</span></span><span style=display:flex><span>     <span style=color:#a6e22e>convolvedImage</span>.<span style=color:#a6e22e>pixels</span>[<span style=color:#a6e22e>loc</span> <span style=color:#f92672>+</span> <span style=color:#ae81ff>2</span>] <span style=color:#f92672>=</span> <span style=color:#a6e22e>blue</span>(<span style=color:#a6e22e>c</span>);
</span></span><span style=display:flex><span>     <span style=color:#a6e22e>convolvedImage</span>.<span style=color:#a6e22e>pixels</span>[<span style=color:#a6e22e>loc</span> <span style=color:#f92672>+</span> <span style=color:#ae81ff>3</span>] <span style=color:#f92672>=</span> <span style=color:#a6e22e>alpha</span>(<span style=color:#a6e22e>c</span>);
</span></span><span style=display:flex><span>   }
</span></span><span style=display:flex><span> }
</span></span><span style=display:flex><span> <span style=color:#a6e22e>convolvedImage</span>.<span style=color:#a6e22e>updatePixels</span>();
</span></span><span style=display:flex><span> <span style=color:#a6e22e>convolvedImage</span>.<span style=color:#a6e22e>save</span>(<span style=color:#a6e22e>name</span>, <span style=color:#e6db74>&#39;png&#39;</span>);
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>convolution</span>(<span style=color:#a6e22e>x</span>, <span style=color:#a6e22e>y</span>, <span style=color:#a6e22e>matrix</span>) {
</span></span><span style=display:flex><span> <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>rtotal</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0.0</span>;
</span></span><span style=display:flex><span> <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>gtotal</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0.0</span>;
</span></span><span style=display:flex><span> <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>btotal</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0.0</span>;
</span></span><span style=display:flex><span> <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>offset</span> <span style=color:#f92672>=</span> Math.<span style=color:#a6e22e>floor</span>(<span style=color:#a6e22e>matrix</span>.<span style=color:#a6e22e>length</span> <span style=color:#f92672>/</span> <span style=color:#ae81ff>2</span>);
</span></span><span style=display:flex><span> <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>let</span> <span style=color:#a6e22e>i</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>; <span style=color:#a6e22e>i</span> <span style=color:#f92672>&lt;</span> <span style=color:#a6e22e>matrix</span>.<span style=color:#a6e22e>length</span>; <span style=color:#a6e22e>i</span><span style=color:#f92672>++</span>){
</span></span><span style=display:flex><span>   <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>let</span> <span style=color:#a6e22e>j</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>; <span style=color:#a6e22e>j</span> <span style=color:#f92672>&lt;</span> <span style=color:#a6e22e>matrix</span>.<span style=color:#a6e22e>length</span>; <span style=color:#a6e22e>j</span><span style=color:#f92672>++</span>){
</span></span><span style=display:flex><span>     
</span></span><span style=display:flex><span>     <span style=color:#75715e>// What pixel are we testing
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>     <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>xloc</span> <span style=color:#f92672>=</span> (<span style=color:#a6e22e>x</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>i</span> <span style=color:#f92672>-</span> <span style=color:#a6e22e>offset</span>);
</span></span><span style=display:flex><span>     <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>yloc</span> <span style=color:#f92672>=</span> (<span style=color:#a6e22e>y</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>j</span> <span style=color:#f92672>-</span> <span style=color:#a6e22e>offset</span>);
</span></span><span style=display:flex><span>     <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>loc</span> <span style=color:#f92672>=</span> (<span style=color:#a6e22e>xloc</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>yloc</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>img</span>.<span style=color:#a6e22e>width</span>) <span style=color:#f92672>*</span> <span style=color:#ae81ff>4</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>     <span style=color:#75715e>// Make sure we haven&#39;t walked off our image, we could do better here
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>     <span style=color:#a6e22e>loc</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>constrain</span>(<span style=color:#a6e22e>loc</span>, <span style=color:#ae81ff>0</span> , <span style=color:#a6e22e>img</span>.<span style=color:#a6e22e>pixels</span>.<span style=color:#a6e22e>length</span> <span style=color:#f92672>-</span> <span style=color:#ae81ff>1</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>     <span style=color:#75715e>// Calculate the convolution
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>     <span style=color:#75715e>// retrieve RGB values
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>     <span style=color:#a6e22e>rtotal</span> <span style=color:#f92672>+=</span> (<span style=color:#a6e22e>img</span>.<span style=color:#a6e22e>pixels</span>[<span style=color:#a6e22e>loc</span>]) <span style=color:#f92672>*</span> <span style=color:#a6e22e>matrix</span>[<span style=color:#a6e22e>i</span>][<span style=color:#a6e22e>j</span>];
</span></span><span style=display:flex><span>     <span style=color:#a6e22e>gtotal</span> <span style=color:#f92672>+=</span> (<span style=color:#a6e22e>img</span>.<span style=color:#a6e22e>pixels</span>[<span style=color:#a6e22e>loc</span> <span style=color:#f92672>+</span> <span style=color:#ae81ff>1</span>]) <span style=color:#f92672>*</span> <span style=color:#a6e22e>matrix</span>[<span style=color:#a6e22e>i</span>][<span style=color:#a6e22e>j</span>];
</span></span><span style=display:flex><span>     <span style=color:#a6e22e>btotal</span> <span style=color:#f92672>+=</span> (<span style=color:#a6e22e>img</span>.<span style=color:#a6e22e>pixels</span>[<span style=color:#a6e22e>loc</span> <span style=color:#f92672>+</span> <span style=color:#ae81ff>2</span>]) <span style=color:#f92672>*</span> <span style=color:#a6e22e>matrix</span>[<span style=color:#a6e22e>i</span>][<span style=color:#a6e22e>j</span>];
</span></span><span style=display:flex><span>   }
</span></span><span style=display:flex><span> }
</span></span><span style=display:flex><span> <span style=color:#75715e>// Make sure RGB is within range
</span></span></span><span style=display:flex><span><span style=color:#75715e></span> <span style=color:#a6e22e>rtotal</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>constrain</span>(<span style=color:#a6e22e>rtotal</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>255</span>);
</span></span><span style=display:flex><span> <span style=color:#a6e22e>gtotal</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>constrain</span>(<span style=color:#a6e22e>gtotal</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>255</span>);
</span></span><span style=display:flex><span> <span style=color:#a6e22e>btotal</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>constrain</span>(<span style=color:#a6e22e>btotal</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>255</span>);
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span> <span style=color:#75715e>// Return the resulting color
</span></span></span><span style=display:flex><span><span style=color:#75715e></span> <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>color</span>(<span style=color:#a6e22e>rtotal</span>, <span style=color:#a6e22e>gtotal</span>, <span style=color:#a6e22e>btotal</span>);
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>applySharpen</span>() {
</span></span><span style=display:flex><span> <span style=color:#a6e22e>convolve</span>(<span style=color:#e6db74>&#34;Sharpen&#34;</span>, <span style=color:#a6e22e>kernels</span>[<span style=color:#e6db74>&#34;Sharpen&#34;</span>]);
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>applyBoxBlur</span>() {
</span></span><span style=display:flex><span> <span style=color:#a6e22e>convolve</span>(<span style=color:#e6db74>&#34;BoxBlur&#34;</span>, <span style=color:#a6e22e>kernels</span>[<span style=color:#e6db74>&#34;BoxBlur&#34;</span>]);
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>applyGaussianBlur3x3</span>() {
</span></span><span style=display:flex><span> <span style=color:#a6e22e>convolve</span>(<span style=color:#e6db74>&#34;GaussianBlur3x3&#34;</span>, <span style=color:#a6e22e>kernels</span>[<span style=color:#e6db74>&#34;GaussianBlur3x3&#34;</span>]);
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>applyGaussianBlur5x5</span>() {
</span></span><span style=display:flex><span> <span style=color:#a6e22e>convolve</span>(<span style=color:#e6db74>&#34;GaussianBlur5x5&#34;</span>, <span style=color:#a6e22e>kernels</span>[<span style=color:#e6db74>&#34;GaussianBlur5x5&#34;</span>]);
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>applyUnsharp5x5</span>() {
</span></span><span style=display:flex><span> <span style=color:#a6e22e>convolve</span>(<span style=color:#e6db74>&#34;Unsharp5x5&#34;</span>, <span style=color:#a6e22e>kernels</span>[<span style=color:#e6db74>&#34;Unsharp5x5&#34;</span>]);
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>kernels</span> <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span> <span style=color:#e6db74>&#34;Sharpen&#34;</span> <span style=color:#f92672>:</span> [[<span style=color:#ae81ff>0</span>,<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>,<span style=color:#ae81ff>0</span>],
</span></span><span style=display:flex><span>              [<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>,<span style=color:#ae81ff>5</span>,<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>],
</span></span><span style=display:flex><span>              [<span style=color:#ae81ff>0</span>,<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>,<span style=color:#ae81ff>0</span>]],
</span></span><span style=display:flex><span> <span style=color:#e6db74>&#34;BoxBlur&#34;</span> <span style=color:#f92672>:</span> [[<span style=color:#ae81ff>1</span><span style=color:#f92672>/</span><span style=color:#ae81ff>9</span>,<span style=color:#ae81ff>1</span><span style=color:#f92672>/</span><span style=color:#ae81ff>9</span>,<span style=color:#ae81ff>1</span><span style=color:#f92672>/</span><span style=color:#ae81ff>9</span>],
</span></span><span style=display:flex><span>               [<span style=color:#ae81ff>1</span><span style=color:#f92672>/</span><span style=color:#ae81ff>9</span>,<span style=color:#ae81ff>1</span><span style=color:#f92672>/</span><span style=color:#ae81ff>9</span>,<span style=color:#ae81ff>1</span><span style=color:#f92672>/</span><span style=color:#ae81ff>9</span>],
</span></span><span style=display:flex><span>               [<span style=color:#ae81ff>1</span><span style=color:#f92672>/</span><span style=color:#ae81ff>9</span>,<span style=color:#ae81ff>1</span><span style=color:#f92672>/</span><span style=color:#ae81ff>9</span>,<span style=color:#ae81ff>1</span><span style=color:#f92672>/</span><span style=color:#ae81ff>9</span>]],
</span></span><span style=display:flex><span> <span style=color:#e6db74>&#34;GaussianBlur3x3&#34;</span> <span style=color:#f92672>:</span> [[<span style=color:#ae81ff>1</span><span style=color:#f92672>/</span><span style=color:#ae81ff>16</span>,<span style=color:#ae81ff>1</span><span style=color:#f92672>/</span><span style=color:#ae81ff>8</span>,<span style=color:#ae81ff>1</span><span style=color:#f92672>/</span><span style=color:#ae81ff>16</span>],
</span></span><span style=display:flex><span>                          [<span style=color:#ae81ff>1</span><span style=color:#f92672>/</span><span style=color:#ae81ff>8</span>,<span style=color:#ae81ff>1</span><span style=color:#f92672>/</span><span style=color:#ae81ff>4</span>,<span style=color:#ae81ff>1</span><span style=color:#f92672>/</span><span style=color:#ae81ff>8</span>],
</span></span><span style=display:flex><span>                          [<span style=color:#ae81ff>1</span><span style=color:#f92672>/</span><span style=color:#ae81ff>16</span>,<span style=color:#ae81ff>1</span><span style=color:#f92672>/</span><span style=color:#ae81ff>8</span>,<span style=color:#ae81ff>1</span><span style=color:#f92672>/</span><span style=color:#ae81ff>16</span>]],
</span></span><span style=display:flex><span> <span style=color:#e6db74>&#34;GaussianBlur5x5&#34;</span> <span style=color:#f92672>:</span> [[<span style=color:#ae81ff>1</span><span style=color:#f92672>/</span><span style=color:#ae81ff>256</span>,<span style=color:#ae81ff>4</span><span style=color:#f92672>/</span><span style=color:#ae81ff>256</span>,<span style=color:#ae81ff>6</span><span style=color:#f92672>/</span><span style=color:#ae81ff>256</span>,<span style=color:#ae81ff>4</span><span style=color:#f92672>/</span><span style=color:#ae81ff>256</span>,<span style=color:#ae81ff>1</span><span style=color:#f92672>/</span><span style=color:#ae81ff>256</span>],
</span></span><span style=display:flex><span>                          [<span style=color:#ae81ff>4</span><span style=color:#f92672>/</span><span style=color:#ae81ff>256</span>,<span style=color:#ae81ff>16</span><span style=color:#f92672>/</span><span style=color:#ae81ff>256</span>,<span style=color:#ae81ff>1</span><span style=color:#f92672>/</span><span style=color:#ae81ff>256</span>,<span style=color:#ae81ff>16</span><span style=color:#f92672>/</span><span style=color:#ae81ff>256</span>,<span style=color:#ae81ff>4</span><span style=color:#f92672>/</span><span style=color:#ae81ff>256</span>],
</span></span><span style=display:flex><span>                          [<span style=color:#ae81ff>6</span><span style=color:#f92672>/</span><span style=color:#ae81ff>256</span>,<span style=color:#ae81ff>24</span><span style=color:#f92672>/</span><span style=color:#ae81ff>256</span>,<span style=color:#ae81ff>36</span><span style=color:#f92672>/</span><span style=color:#ae81ff>256</span>,<span style=color:#ae81ff>24</span><span style=color:#f92672>/</span><span style=color:#ae81ff>256</span>,<span style=color:#ae81ff>6</span><span style=color:#f92672>/</span><span style=color:#ae81ff>256</span>],
</span></span><span style=display:flex><span>                          [<span style=color:#ae81ff>4</span><span style=color:#f92672>/</span><span style=color:#ae81ff>256</span>,<span style=color:#ae81ff>16</span><span style=color:#f92672>/</span><span style=color:#ae81ff>256</span>,<span style=color:#ae81ff>1</span><span style=color:#f92672>/</span><span style=color:#ae81ff>256</span>,<span style=color:#ae81ff>16</span><span style=color:#f92672>/</span><span style=color:#ae81ff>256</span>,<span style=color:#ae81ff>4</span><span style=color:#f92672>/</span><span style=color:#ae81ff>256</span>],
</span></span><span style=display:flex><span>                          [<span style=color:#ae81ff>1</span><span style=color:#f92672>/</span><span style=color:#ae81ff>256</span>,<span style=color:#ae81ff>4</span><span style=color:#f92672>/</span><span style=color:#ae81ff>256</span>,<span style=color:#ae81ff>6</span><span style=color:#f92672>/</span><span style=color:#ae81ff>256</span>,<span style=color:#ae81ff>4</span><span style=color:#f92672>/</span><span style=color:#ae81ff>256</span>,<span style=color:#ae81ff>1</span><span style=color:#f92672>/</span><span style=color:#ae81ff>256</span>]],
</span></span><span style=display:flex><span> <span style=color:#e6db74>&#34;Unsharp5x5&#34;</span> <span style=color:#f92672>:</span> [[<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span><span style=color:#f92672>/</span><span style=color:#ae81ff>256</span>,<span style=color:#f92672>-</span><span style=color:#ae81ff>4</span><span style=color:#f92672>/</span><span style=color:#ae81ff>256</span>,<span style=color:#f92672>-</span><span style=color:#ae81ff>6</span><span style=color:#f92672>/</span><span style=color:#ae81ff>256</span>,<span style=color:#f92672>-</span><span style=color:#ae81ff>4</span><span style=color:#f92672>/</span><span style=color:#ae81ff>256</span>,<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span><span style=color:#f92672>/</span><span style=color:#ae81ff>256</span>],
</span></span><span style=display:flex><span>                            [<span style=color:#f92672>-</span><span style=color:#ae81ff>4</span><span style=color:#f92672>/</span><span style=color:#ae81ff>256</span>,<span style=color:#f92672>-</span><span style=color:#ae81ff>16</span><span style=color:#f92672>/</span><span style=color:#ae81ff>256</span>,<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span><span style=color:#f92672>/</span><span style=color:#ae81ff>256</span>,<span style=color:#f92672>-</span><span style=color:#ae81ff>16</span><span style=color:#f92672>/</span><span style=color:#ae81ff>256</span>,<span style=color:#f92672>-</span><span style=color:#ae81ff>4</span><span style=color:#f92672>/</span><span style=color:#ae81ff>256</span>],
</span></span><span style=display:flex><span>                            [<span style=color:#f92672>-</span><span style=color:#ae81ff>6</span><span style=color:#f92672>/</span><span style=color:#ae81ff>256</span>,<span style=color:#f92672>-</span><span style=color:#ae81ff>24</span><span style=color:#f92672>/</span><span style=color:#ae81ff>256</span>,<span style=color:#ae81ff>476</span><span style=color:#f92672>/</span><span style=color:#ae81ff>256</span>,<span style=color:#f92672>-</span><span style=color:#ae81ff>24</span><span style=color:#f92672>/</span><span style=color:#ae81ff>256</span>,<span style=color:#f92672>-</span><span style=color:#ae81ff>6</span><span style=color:#f92672>/</span><span style=color:#ae81ff>256</span>],
</span></span><span style=display:flex><span>                            [<span style=color:#f92672>-</span><span style=color:#ae81ff>4</span><span style=color:#f92672>/</span><span style=color:#ae81ff>256</span>,<span style=color:#f92672>-</span><span style=color:#ae81ff>16</span><span style=color:#f92672>/</span><span style=color:#ae81ff>256</span>,<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span><span style=color:#f92672>/</span><span style=color:#ae81ff>256</span>,<span style=color:#f92672>-</span><span style=color:#ae81ff>16</span><span style=color:#f92672>/</span><span style=color:#ae81ff>256</span>,<span style=color:#f92672>-</span><span style=color:#ae81ff>4</span><span style=color:#f92672>/</span><span style=color:#ae81ff>256</span>],
</span></span><span style=display:flex><span>                            [<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span><span style=color:#f92672>/</span><span style=color:#ae81ff>256</span>,<span style=color:#f92672>-</span><span style=color:#ae81ff>4</span><span style=color:#f92672>/</span><span style=color:#ae81ff>256</span>,<span style=color:#f92672>-</span><span style=color:#ae81ff>6</span><span style=color:#f92672>/</span><span style=color:#ae81ff>256</span>,<span style=color:#f92672>-</span><span style=color:#ae81ff>4</span><span style=color:#f92672>/</span><span style=color:#ae81ff>256</span>,<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span><span style=color:#f92672>/</span><span style=color:#ae81ff>256</span>]],
</span></span><span style=display:flex><span>};
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>img</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>input</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>histogramTypeSelect</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>sharpenButton</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>boxBlurButton</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>gaussianBlur3x3Button</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>gaussianBlur5x5Button</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>unsharpMasking5x5Button</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>lumaButton</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>handleFiles</span>() {
</span></span><span style=display:flex><span> <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>fileList</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>files</span>; <span style=color:#75715e>/* now you can work with the file list */</span>
</span></span><span style=display:flex><span> <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>file</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>fileList</span>[<span style=color:#ae81ff>0</span>]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span> <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>reader</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>FileReader</span>();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span> <span style=color:#a6e22e>reader</span>.<span style=color:#a6e22e>onload</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>function</span>(<span style=color:#a6e22e>e</span>) {
</span></span><span style=display:flex><span>   <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>file</span>.<span style=color:#a6e22e>type</span> <span style=color:#f92672>===</span> <span style=color:#e6db74>&#39;image/png&#39;</span> <span style=color:#f92672>||</span> <span style=color:#a6e22e>file</span>.<span style=color:#a6e22e>type</span> <span style=color:#f92672>===</span> <span style=color:#e6db74>&#39;image/jpeg&#39;</span>) {
</span></span><span style=display:flex><span>     <span style=color:#a6e22e>img</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>loadImage</span>(<span style=color:#a6e22e>e</span>.<span style=color:#a6e22e>target</span>.<span style=color:#a6e22e>result</span>, <span style=color:#e6db74>&#39;&#39;</span>);
</span></span><span style=display:flex><span>     <span style=color:#a6e22e>img</span>.<span style=color:#a6e22e>loadPixels</span>();
</span></span><span style=display:flex><span>   } <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>     <span style=color:#a6e22e>img</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>null</span>;
</span></span><span style=display:flex><span>   }
</span></span><span style=display:flex><span> }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span> <span style=color:#a6e22e>reader</span>.<span style=color:#a6e22e>readAsDataURL</span>(<span style=color:#a6e22e>file</span>);
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>setup</span>() {
</span></span><span style=display:flex><span> <span style=color:#a6e22e>createCanvas</span>(<span style=color:#a6e22e>HW</span><span style=color:#f92672>+</span><span style=color:#ae81ff>100</span>, <span style=color:#a6e22e>HH</span><span style=color:#f92672>+</span><span style=color:#ae81ff>100</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>HP</span>);
</span></span><span style=display:flex><span> <span style=color:#a6e22e>input</span> <span style=color:#f92672>=</span> document.<span style=color:#a6e22e>getElementById</span>(<span style=color:#e6db74>&#34;file-input&#34;</span>);
</span></span><span style=display:flex><span> <span style=color:#a6e22e>input</span>.<span style=color:#a6e22e>addEventListener</span>(<span style=color:#e6db74>&#34;change&#34;</span>, <span style=color:#a6e22e>handleFiles</span>, <span style=color:#66d9ef>false</span>);
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span> <span style=color:#a6e22e>histogramTypeSelect</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>createSelect</span>();
</span></span><span style=display:flex><span> <span style=color:#a6e22e>histogramTypeSelect</span>.<span style=color:#a6e22e>position</span>(<span style=color:#a6e22e>HP</span><span style=color:#f92672>-</span><span style=color:#ae81ff>50</span>, <span style=color:#a6e22e>HP</span><span style=color:#f92672>-</span><span style=color:#ae81ff>50</span>);
</span></span><span style=display:flex><span> <span style=color:#a6e22e>histogramTypeSelect</span>.<span style=color:#a6e22e>option</span>(<span style=color:#e6db74>&#39;RGB&#39;</span>); 
</span></span><span style=display:flex><span> <span style=color:#a6e22e>histogramTypeSelect</span>.<span style=color:#a6e22e>option</span>(<span style=color:#e6db74>&#39;Brightness&#39;</span>);
</span></span><span style=display:flex><span> <span style=color:#a6e22e>histogramTypeSelect</span>.<span style=color:#a6e22e>hide</span>();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span> <span style=color:#a6e22e>sharpenButton</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>createButton</span>(<span style=color:#e6db74>&#39;Sharpen&#39;</span>);
</span></span><span style=display:flex><span> <span style=color:#a6e22e>sharpenButton</span>.<span style=color:#a6e22e>position</span>(<span style=color:#ae81ff>10</span>, <span style=color:#ae81ff>30</span>);
</span></span><span style=display:flex><span> <span style=color:#a6e22e>sharpenButton</span>.<span style=color:#a6e22e>mousePressed</span>(<span style=color:#a6e22e>applySharpen</span>);
</span></span><span style=display:flex><span> <span style=color:#a6e22e>sharpenButton</span>.<span style=color:#a6e22e>hide</span>();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span> <span style=color:#a6e22e>boxBlurButton</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>createButton</span>(<span style=color:#e6db74>&#39;Box blur&#39;</span>);
</span></span><span style=display:flex><span> <span style=color:#a6e22e>boxBlurButton</span>.<span style=color:#a6e22e>position</span>(<span style=color:#ae81ff>10</span>, <span style=color:#ae81ff>70</span>);
</span></span><span style=display:flex><span> <span style=color:#a6e22e>boxBlurButton</span>.<span style=color:#a6e22e>mousePressed</span>(<span style=color:#a6e22e>applyBoxBlur</span>);
</span></span><span style=display:flex><span> <span style=color:#a6e22e>boxBlurButton</span>.<span style=color:#a6e22e>hide</span>();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span> <span style=color:#a6e22e>gaussianBlur3x3Button</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>createButton</span>(<span style=color:#e6db74>&#39;Gaussian blur(3x3)&#39;</span>);
</span></span><span style=display:flex><span> <span style=color:#a6e22e>gaussianBlur3x3Button</span>.<span style=color:#a6e22e>position</span>(<span style=color:#ae81ff>10</span>, <span style=color:#ae81ff>110</span>);
</span></span><span style=display:flex><span> <span style=color:#a6e22e>gaussianBlur3x3Button</span>.<span style=color:#a6e22e>mousePressed</span>(<span style=color:#a6e22e>applyGaussianBlur3x3</span>);
</span></span><span style=display:flex><span> <span style=color:#a6e22e>gaussianBlur3x3Button</span>.<span style=color:#a6e22e>hide</span>();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span> <span style=color:#a6e22e>gaussianBlur5x5Button</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>createButton</span>(<span style=color:#e6db74>&#39;Gaussian blur(5x5)&#39;</span>);
</span></span><span style=display:flex><span> <span style=color:#a6e22e>gaussianBlur5x5Button</span>.<span style=color:#a6e22e>position</span>(<span style=color:#ae81ff>200</span>, <span style=color:#ae81ff>30</span>);
</span></span><span style=display:flex><span> <span style=color:#a6e22e>gaussianBlur5x5Button</span>.<span style=color:#a6e22e>mousePressed</span>(<span style=color:#a6e22e>applyGaussianBlur5x5</span>);
</span></span><span style=display:flex><span> <span style=color:#a6e22e>gaussianBlur5x5Button</span>.<span style=color:#a6e22e>hide</span>();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span> <span style=color:#a6e22e>unsharpMasking5x5Button</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>createButton</span>(<span style=color:#e6db74>&#39;Unsharp&#39;</span>);
</span></span><span style=display:flex><span> <span style=color:#a6e22e>unsharpMasking5x5Button</span>.<span style=color:#a6e22e>position</span>(<span style=color:#ae81ff>200</span>, <span style=color:#ae81ff>70</span>);
</span></span><span style=display:flex><span> <span style=color:#a6e22e>unsharpMasking5x5Button</span>.<span style=color:#a6e22e>mousePressed</span>(<span style=color:#a6e22e>applyUnsharp5x5</span>);
</span></span><span style=display:flex><span> <span style=color:#a6e22e>unsharpMasking5x5Button</span>.<span style=color:#a6e22e>hide</span>();
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span> <span style=color:#a6e22e>lumaButton</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>createButton</span>(<span style=color:#e6db74>&#39;Luminance&#39;</span>);
</span></span><span style=display:flex><span> <span style=color:#a6e22e>lumaButton</span>.<span style=color:#a6e22e>position</span>(<span style=color:#ae81ff>200</span>, <span style=color:#ae81ff>110</span>);
</span></span><span style=display:flex><span> <span style=color:#a6e22e>lumaButton</span>.<span style=color:#a6e22e>mousePressed</span>(<span style=color:#a6e22e>applyLuma</span>);
</span></span><span style=display:flex><span> <span style=color:#a6e22e>lumaButton</span>.<span style=color:#a6e22e>hide</span>();
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>draw</span>() {
</span></span><span style=display:flex><span> <span style=color:#a6e22e>background</span>(<span style=color:#ae81ff>0</span>);
</span></span><span style=display:flex><span> <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>img</span>) {
</span></span><span style=display:flex><span>   <span style=color:#a6e22e>histogramTypeSelect</span>.<span style=color:#a6e22e>show</span>();
</span></span><span style=display:flex><span>   <span style=color:#a6e22e>sharpenButton</span>.<span style=color:#a6e22e>show</span>();
</span></span><span style=display:flex><span>   <span style=color:#a6e22e>boxBlurButton</span>.<span style=color:#a6e22e>show</span>();
</span></span><span style=display:flex><span>   <span style=color:#a6e22e>gaussianBlur3x3Button</span>.<span style=color:#a6e22e>show</span>();
</span></span><span style=display:flex><span>   <span style=color:#a6e22e>gaussianBlur5x5Button</span>.<span style=color:#a6e22e>show</span>();
</span></span><span style=display:flex><span>   <span style=color:#a6e22e>unsharpMasking5x5Button</span>.<span style=color:#a6e22e>show</span>();
</span></span><span style=display:flex><span>   <span style=color:#a6e22e>lumaButton</span>.<span style=color:#a6e22e>show</span>();
</span></span><span style=display:flex><span>   <span style=color:#a6e22e>img</span>.<span style=color:#a6e22e>loadPixels</span>();
</span></span><span style=display:flex><span>   <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>histogramTypeSelect</span>.<span style=color:#a6e22e>value</span>() <span style=color:#f92672>===</span> <span style=color:#e6db74>&#39;RGB&#39;</span>) {
</span></span><span style=display:flex><span>     <span style=color:#a6e22e>drawRGBHistogram</span>(<span style=color:#a6e22e>img</span>.<span style=color:#a6e22e>pixels</span>);
</span></span><span style=display:flex><span>   } <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>     <span style=color:#a6e22e>drawBrightnessHistogram</span>(<span style=color:#a6e22e>img</span>.<span style=color:#a6e22e>pixels</span>)
</span></span><span style=display:flex><span>   }
</span></span><span style=display:flex><span> }
</span></span><span style=display:flex><span>}</span></span></code></pre></div></div></details><p>To get the script working properly, we need to add an html input element that is going to be used by the script.</p><details><summary>input-element.html</summary><div class=markdown-inner><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#f92672>&lt;</span><span style=color:#a6e22e>div</span> <span style=color:#66d9ef>class</span><span style=color:#f92672>=</span><span style=color:#a6e22e>controls</span><span style=color:#f92672>&gt;&lt;</span><span style=color:#a6e22e>input</span> <span style=color:#a6e22e>id</span><span style=color:#f92672>=</span><span style=color:#a6e22e>file</span><span style=color:#f92672>-</span><span style=color:#a6e22e>input</span> <span style=color:#a6e22e>type</span><span style=color:#f92672>=</span><span style=color:#a6e22e>file</span><span style=color:#f92672>&gt;&lt;</span><span style=color:#960050;background-color:#1e0010>/div&gt;</span></span></span></code></pre></div></div></details><p>To show how the script works, in the next sketch a random image is loaded and after the process is applied, the result is shown replacing the actual image.</p><p>You can select three different modes:</p><ul><li>RGB histogram: display the rgb histogram for the actual image.</li><li>Brightness histogram: display the brightness histogram for the actual image.</li><li>Image: display the actual image according to the process or original if you click that button.</li></ul><p>Finally you can refresh the image that is being used.</p><iframe id=web_app style=width:610px;height:750px srcdoc="
        <!DOCTYPE html>
        <html>
          <head>
            <script src=https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.5.0/p5.min.js></script>
            <script src=https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.5.0/addons/p5.sound.min.js></script>
            
            
            
            
            
            <script src=/showcase/sketches/exercises/masking/web_app.js></script>
          </head>
          <body>
          </body>
        </html>
      "></iframe><p>But if you want to use the original script, here is an sketch that uses it, you can download your modified images feel free to extend the script and provide it to the community.</p><iframe id=original_web_app style=width:610px;height:750px srcdoc="
        <!DOCTYPE html>
        <html>
          <head>
            <script src=https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.5.0/p5.min.js></script>
            <script src=https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.5.0/addons/p5.sound.min.js></script>
            
            
            
            
            
            <script src=/showcase/sketches/exercises/masking/original_web_app.js></script>
          </head>
          <body>
            <div class=controls><input id=file-input type=file></div>
          </body>
        </html>
      "></iframe></article><footer class=book-footer><div class="flex flex-wrap justify-between"><div><a class="flex align-center" href=https://github.com/visualcomputing/showcase/commit/d7cac9e4a650ccf1fccba18e35b3e548c052ef2a title='Last modified by Andryut | March 28, 2023' target=_blank rel=noopener><img src=/showcase/svg/calendar.svg class=book-icon alt=Calendar>
<span>March 28, 2023</span></a></div></div><script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){if(window.getSelection().toString())return;e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script></footer><div class=book-comments></div><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><nav id=TableOfContents><ul><li><a href=#masking>Masking</a><ul><li><a href=#web-app>Web app</a></li></ul></li></ul></nav></div></aside></main></body></html>